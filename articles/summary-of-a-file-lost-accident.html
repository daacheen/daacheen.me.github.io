<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"><head><meta charSet="utf-8"/><link rel="stylesheet" href="/_next/static/css/3cd875c779557762.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c61fd82c0ec3c846.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/550cc6711c036586.css" data-precedence="next"/><title>一次生产环境的文件丢失事故：复盘和教训 - ddadaal.me</title><meta name="description" content="ddadaal&#x27;s personal website"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><link rel="icon" href="/icon.svg?35be8e76be1c3618" type="image/svg+xml" sizes="500x500"/><link rel="apple-touch-icon" href="/apple-icon.png?5334a64f42000bb0" type="image/png" sizes="180x180"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" noModule=""></script></head><body class="w-full"><div class="items-center sticky z-50 w-full h-13 transition -top-[1px] bg-base-200 text-base-content"><div class="flex justify-between items-center max-w-7xl mx-auto px-4"><a class="flex items-center justify-center space-x-1" href="/"><img alt="logo" loading="lazy" width="42" height="42" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/logo.8f2bd5ec.svg"/><h1 class="text-sm font-bold">ddadaal.me</h1></a><div class="flex items-center gap-1"><div class="hidden lg:flex"><ul class="menu menu-horizontal"><li><a class="" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>主页</a></li><li><a class="active" href="/articles"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>文章</a></li><li><details><summary class=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg>简历</summary><ul class="shadow bg-base-200 text-base-content"><li><a class="" href="/resume/cn">🇨🇳 <!-- -->简体中文</a></li><li><a class="" href="/resume/en">🇺🇸 <!-- -->English</a></li></ul></details></li><li><a class="" href="/slides"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M187.7 153.7c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7s61.7-26 61.7-57.7c0-32-27.7-57.7-61.7-57.7zm143.4 0c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7 34.3 0 61.7-26 61.7-57.7.1-32-27.4-57.7-61.7-57.7zm156.6 90l-6 4.3V49.7c0-27.4-20.6-49.7-46-49.7H76.6c-25.4 0-46 22.3-46 49.7V248c-2-1.4-4.3-2.9-6.3-4.3-15.1-10.6-25.1 4-16 17.7 18.3 22.6 53.1 50.3 106.3 72C58.3 525.1 252 555.7 248.9 457.5c0-.7.3-56.6.3-96.6 5.1 1.1 9.4 2.3 13.7 3.1 0 39.7.3 92.8.3 93.5-3.1 98.3 190.6 67.7 134.3-124 53.1-21.7 88-49.4 106.3-72 9.1-13.8-.9-28.3-16.1-17.8zm-30.5 19.2c-68.9 37.4-128.3 31.1-160.6 29.7-23.7-.9-32.6 9.1-33.7 24.9-10.3-7.7-18.6-15.5-20.3-17.1-5.1-5.4-13.7-8-27.1-7.7-31.7 1.1-89.7 7.4-157.4-28V72.3c0-34.9 8.9-45.7 40.6-45.7h317.7c30.3 0 40.9 12.9 40.9 45.7v190.6z"></path></svg>幻灯片</a></li><li><details><summary class=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg>关于</summary><ul class="shadow bg-base-200 text-base-content"><li><a class="" href="/about/odyssey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>一个个人博客的史诗</a></li><li><a class="" href="/about/project"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg>关于网站</a></li><li><a class="" href="/about/me"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0c35.346 0 64 28.654 64 64s-28.654 64-64 64-64-28.654-64-64S60.654 0 96 0m48 144h-11.36c-22.711 10.443-49.59 10.894-73.28 0H48c-26.51 0-48 21.49-48 48v136c0 13.255 10.745 24 24 24h16v136c0 13.255 10.745 24 24 24h64c13.255 0 24-10.745 24-24V352h16c13.255 0 24-10.745 24-24V192c0-26.51-21.49-48-48-48z"></path></svg>关于我</a></li></ul></details></li></ul></div><div class="dropdown dropdown-end"><label tabindex="0" class="btn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path></svg><span class="hidden sm:block">自动</span></label><ul tabindex="0" class="dropdown-content menu p-2 bg-base-200 text-base-content shadow rounded-box w-52"><li><a class="justify-between">自动</a></li><li><a class="justify-between">明亮</a></li><li><a class="justify-between">暗色</a></li><li><a class="justify-between">杯子蛋糕</a></li><li><a class="justify-between">大黄蜂</a></li><li><a class="justify-between">白色商务</a></li><li><a class="justify-between">黑色商务</a></li><li><a class="justify-between">金色奢华</a></li><li><a class="justify-between">夏日柠檬</a></li><li><a class="justify-between">绿野仙踪</a></li><li><a class="justify-between">复古</a></li><li><a class="justify-between">粉色浪漫</a></li><li><a class="justify-between">赛博朋克</a></li></ul></div><div class="dropdown dropdown-end"><label tabindex="0" class="btn">🇨🇳 <span class="hidden sm:block">简体中文</span></label><ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-200 rounded-box w-52 text-base-content"><li><a class="justify-between">🇨🇳 <!-- -->简体中文</a></li><li><a class="justify-between">🇺🇸 <!-- -->English</a></li></ul></div><div class="dropdown dropdown-end lg:hidden"><label tabindex="0" class="btn btn-ghost"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg></label><ul tabindex="0" class="menu menu-compact dropdown-content mt-3 p-2 shadow rounded-box bg-base-200 text-base-content "><li><a class="" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>主页</a></li><li><a class="active" href="/articles"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>文章</a></li><li><a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg>简历</a><ul><li><a class="" href="/resume/cn">🇨🇳 <!-- -->简体中文</a></li><li><a class="" href="/resume/en">🇺🇸 <!-- -->English</a></li></ul></li><li><a class="" href="/slides"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M187.7 153.7c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7s61.7-26 61.7-57.7c0-32-27.7-57.7-61.7-57.7zm143.4 0c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7 34.3 0 61.7-26 61.7-57.7.1-32-27.4-57.7-61.7-57.7zm156.6 90l-6 4.3V49.7c0-27.4-20.6-49.7-46-49.7H76.6c-25.4 0-46 22.3-46 49.7V248c-2-1.4-4.3-2.9-6.3-4.3-15.1-10.6-25.1 4-16 17.7 18.3 22.6 53.1 50.3 106.3 72C58.3 525.1 252 555.7 248.9 457.5c0-.7.3-56.6.3-96.6 5.1 1.1 9.4 2.3 13.7 3.1 0 39.7.3 92.8.3 93.5-3.1 98.3 190.6 67.7 134.3-124 53.1-21.7 88-49.4 106.3-72 9.1-13.8-.9-28.3-16.1-17.8zm-30.5 19.2c-68.9 37.4-128.3 31.1-160.6 29.7-23.7-.9-32.6 9.1-33.7 24.9-10.3-7.7-18.6-15.5-20.3-17.1-5.1-5.4-13.7-8-27.1-7.7-31.7 1.1-89.7 7.4-157.4-28V72.3c0-34.9 8.9-45.7 40.6-45.7h317.7c30.3 0 40.9 12.9 40.9 45.7v190.6z"></path></svg>幻灯片</a></li><li><a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg>关于</a><ul><li><a class="" href="/about/odyssey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>一个个人博客的史诗</a></li><li><a class="" href="/about/project"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg>关于网站</a></li><li><a class="" href="/about/me"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0c35.346 0 64 28.654 64 64s-28.654 64-64 64-64-28.654-64-64S60.654 0 96 0m48 144h-11.36c-22.711 10.443-49.59 10.894-73.28 0H48c-26.51 0-48 21.49-48 48v136c0 13.255 10.745 24 24 24h16v136c0 13.255 10.745 24 24 24h64c13.255 0 24-10.745 24-24V352h16c13.255 0 24-10.745 24-24V192c0-26.51-21.49-48-48-48z"></path></svg>关于我</a></li></ul></li></ul></div></div></div></div><div><article><div class="bg-neutral px-4 py-8"><div class="max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content"><div class="flex flex-col animate-slide-up"><h1 class="text-4xl my-2">一次生产环境的文件丢失事故：复盘和教训</h1><div class="flex flex-wrap gap-3 my-2 text-sm justify-center"><div class="flex flex-wrap gap-1 items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=problem-investigation">问题探究</a><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=project">我的项目</a></div><div class="flex items-center" title="发表时间"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg><span class="mx-0.5">2021-07-21 13:13:00 UTC+8</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm57.1 120H305c7.7 0 13.4 7.1 11.7 14.7l-38 168c-1.2 5.5-6.1 9.3-11.7 9.3h-38c-5.5 0-10.3-3.8-11.6-9.1-25.8-103.5-20.8-81.2-25.6-110.5h-.5c-1.1 14.3-2.4 17.4-25.6 110.5-1.3 5.3-6.1 9.1-11.6 9.1H117c-5.6 0-10.5-3.9-11.7-9.4l-37.8-168c-1.7-7.5 4-14.6 11.7-14.6h24.5c5.7 0 10.7 4 11.8 9.7 15.6 78 20.1 109.5 21 122.2 1.6-10.2 7.3-32.7 29.4-122.7 1.3-5.4 6.1-9.1 11.7-9.1h29.1c5.6 0 10.4 3.8 11.7 9.2 24 100.4 28.8 124 29.6 129.4-.2-11.2-2.6-17.8 21.6-129.2 1-5.6 5.9-9.5 11.5-9.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg><span class="mx-0.5">3034 字</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg><span class="mx-0.5">16 分钟阅读</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg><span class="mx-0.5 space-x-1"><a class="link link-hover" href="/articles/summary-of-a-file-lost-accident/cn">简体中文</a></span></div></div></div></div></div><div class="animate-slide-up"><div class="max-w-7xl mx-auto p-4"><div class="flex flex-row space-x-4"><div class="prose max-w-full lg:w-[75%]"><h1 id="生产事故"><a href="#生产事故" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>生产事故</h1>
<p>我最近负责了一个比赛后台网站的开发和维护，在比赛临近结束、正在接受用户提交成果文件的时候出了一场生产事故，造成了丢失了一段时间内用户上传的文件。本文主要讲讲生产事故从发现到确定影响范围到确定原因的过程。在整个过程中，后台程序记录的日志起到了巨大的作用。</p>
<p>关于这个项目的总结，可以查看这篇文章：<a href="/articles/summary-of-my-first-real-project">我的第一个真实项目：总结和经验</a>。</p>
<h1 id="tldr"><a href="#tldr" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>TL;DR</h1>





























<table><thead><tr><th>要素</th><th>内容</th></tr></thead><tbody><tr><td>表现</td><td>丢失<code>2021-07-16 09:00:10</code>至<code>2021-07-17 18:00:57</code>期间所上传的文件</td></tr><tr><td>原因</td><td>7月16日的一次提交，使得之后文件上传到了一个容器内部的、没有mount出来的目录，容器重启后，这些文件丢失了</td></tr><tr><td>补救</td><td>进入容器，找回了最后一次容器重启后到问题发生期间上传的文件</td></tr><tr><td>后续处理</td><td>通过log、数据库数据等找到了受到影响的用户，通过邮箱、电话和短信提醒他们重新上传文件</td></tr><tr><td>经验</td><td>实现依赖业务，而非业务依赖实现；重视测试细节；log中记录尽可能多的信息</td></tr></tbody></table>
<h1 id="问题发现"><a href="#问题发现" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>问题发现</h1>
<p>项目基本情况是这样的。用户可以注册团队，一个团队有一个队长，队长可以提交一个团队的成果文件。管理员可以看到各个队伍的提交情况，以及也可以直接下载团队提交的文件。</p>
<p>19日下午4点左右，我用管理员登录了系统，本来只是在随便看看有哪些团队提交了成果，结果突然发现有的团队的成果点击下载下不下来。</p>
<p><figure><img alt="点击下载提交的团队的成果发现出错" loading="lazy" width="435" height="135" decoding="async" data-nimg="1" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/download-error.png?width=640 1x, /articles/asset/contents/20210721-summary-of-a-file-lost-accident/download-error.png?width=1080 2x" src="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/download-error.png?width=1080"/><figcaption class="text-center">点击下载提交的团队的成果发现出错</figcaption></figure></p>
<p>赶紧上服务器上看是怎么回事。打开服务器存放上传的文件的目录，grep一下发现对应的ID发现没有这个文件。</p>
<p>上传文件的逻辑是这样的：</p>
<ol>
<li>获取上传的文件</li>
<li>把文件保存到<code>upload/{团队ID}/文件名</code>
<ol>
<li>保存之前，打日志<code>Received file {文件名} from {用户ID}. Saving it to {完整路径}.</code></li>
<li>保存完成后，打日志<code>${完整路径} saved successfully.</code></li>
</ol>
</li>
<li>更新数据库，记录文件名(列名为<code>filename</code>)和上传时间（<code>last_update_time</code>）</li>
</ol>
<p>如果第二步失败，就不能进行第三步，不会出现保存文件失败但是写了数据库的情况。但是如果没有写数据库，我在后台就不会看到这个团队有成果，就不会能够点击下载了。</p>
<p>后端程序运行在docker中，但是<code>upload</code>是一个mounted volume，其中的文件和容器外的一个目录是进行了共享的，所以不管容器怎么重启，这里面的文件是不会掉的。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="default"><code data-language="yaml" data-theme="default"><span class="line"><span style="color:#7F848E;font-style:italic"># docker-compose相关部分, /dist是容器中存放程序文件的根目录</span></span>
<span class="line"><span style="color:#E06C75">backend</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">volumes</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">&quot;./backend/upload:/dist/upload&quot;</span></span></code></pre></div>
<p>马上翻了下日志，按上面说的格式搜一下日志（下面的队伍ID为实际的团队ID）：</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="logql" data-theme="default"><code data-language="logql" data-theme="default"><span class="line"><span style="color:#abb2bf">{container_name=&quot;backend&quot;}|=&quot;Saving it to upload/队伍ID&quot;</span></span></code></pre></div>
<p>发现<strong>没有结果</strong>。</p>
<p>这就奇怪了，于是把<code>upload/队伍ID</code>从查询语句中删除，直接看有哪些保存的日志，这一看就出事了。我看到了一堆这样的日志：</p>
<pre><code>{&quot;level&quot;:30,&quot;time&quot;:1626528267191,&quot;pid&quot;:36,&quot;hostname&quot;:&quot;2358983e224d&quot;,&quot;reqId&quot;:&quot;req-29&quot;,&quot;msg&quot;:&quot;Received file 文件名.zip from 用户ID.\n    Saving it to 团队ID/文件名.zip.&quot;}
</code></pre>
<p>文件被保存到<code>{团队ID}/文件名</code>下了！而<code>{团队ID}</code>这些目录是没有被mount的，容器重启就重启了，没了！</p>
<p>马上进入容器里运行<code>ls</code>，果然在容器根目录看到了一堆<code>{团队ID}</code>的目录。</p>
<h1 id="确定影响范围和补救"><a href="#确定影响范围和补救" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>确定影响范围和补救</h1>
<p>首先，我把容器里已有的这些文件复制了出来，并定时检查有没有新的文件。还好，在排查问题的整个过程中都没有新的文件名上传。这些文件应该是在上一次容器重启之后才上传的。</p>
<p>之后，是找到哪些队伍的文件仍然丢失了，也就是数据库中<code>filename</code>不是NULL，但是<code>upload</code>下面没有这个队伍。这些队伍的文件应该是在上一次重启之前就上传了，上一次重启使得这些文件丢失了，应该是无法找回了。</p>
<p>通过各种查找资料，写出来以下的bash脚本：</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="default"><code data-language="bash" data-theme="default"><span class="line"><span style="color:#7F848E;font-style:italic"># 查询filename不是NULL的团队的ID，写入db.txt</span></span>
<span class="line"><span style="color:#E06C75">query</span><span style="color:#56B6C2">=</span><span style="color:#98C379">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379">use data_competition_prod;</span></span>
<span class="line"><span style="color:#98C379">select id from team where filename is not null;</span></span>
<span class="line"><span style="color:#98C379">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#56B6C2">echo</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">$query</span><span style="color:#ABB2BF"> | </span><span style="color:#61AFEF">mysql</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-u</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">root</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-h</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">127.0</span><span style="color:#98C379">.0.1</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-P</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">3306</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-p密码</span><span style="color:#ABB2BF"> | </span><span style="color:#61AFEF">sed</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&#x27;1d&#x27;</span><span style="color:#ABB2BF"> | </span><span style="color:#61AFEF">sort</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-n</span><span style="color:#ABB2BF"> &gt; </span><span style="color:#98C379">db.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># 查询upload下的所有目录名，写入folder.txt</span></span>
<span class="line"><span style="color:#61AFEF">ls</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-d</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">*</span><span style="color:#98C379">/</span><span style="color:#ABB2BF"> | </span><span style="color:#61AFEF">cut</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-f1</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-d</span><span style="color:#98C379">&#x27;/&#x27;</span><span style="color:#ABB2BF"> | </span><span style="color:#61AFEF">sort</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">-n</span><span style="color:#ABB2BF"> &gt; </span><span style="color:#98C379">folder.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># diff两个文件</span></span>
<span class="line"><span style="color:#61AFEF">diff</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">db.txt</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">folder.txt</span></span></code></pre></div>
<p>这个bash脚本得出filename不是NULL的、但是upload下没有对应的目录有<strong>11</strong>个。所以这11个团队的文件是丢失了。</p>
<p>但是除了丢失文件的情况，还有在出现问题之前就上传了版本，但是在这问题发生后更新了文件。这样，虽然在系统上有他们的问题，但是这些文件版本不是最终的版本。</p>
<p>为了找到这些团队，首先需要找到最近几次重启的时间，以及问题开始时的时间。容器重启的时候之前的容器会被强制退出，会打出有<code>npm ERR</code>的日志，通过这个ERR可以找到最近几次重启的时间。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="logql" data-theme="default"><code data-language="logql" data-theme="default"><span class="line"><span style="color:#abb2bf">{container_name=&quot;backend&quot;}|=&quot;npm ERR&quot;</span></span></code></pre></div>
<p><figure><img alt="最近几次重启的时间" loading="lazy" width="1579" height="588" decoding="async" data-nimg="1" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/reboot-logs.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-a-file-lost-accident/reboot-logs.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/reboot-logs.png?width=3840"/><figcaption class="text-center">最近几次重启的时间</figcaption></figure></p>
<p>可以看到图上有三次重启：</p>
<ul>
<li><code>2021-07-16 09:00:10</code> (<code>t1</code>)</li>
<li><code>2021-07-16 15:50:07</code></li>
<li><code>2021-07-17 18:00:57</code> (<code>t3</code>)</li>
</ul>
<p>最后一次重启（19日的）是后面修改代码中的bug引发的重启，此时文件能恢复的文件已经恢复。而查询时间段之前的代码我知道是没有问题的。所以可以确定，<code>t1</code>-<code>t3</code>之间的数据是丢失了，而我之前从容器中补救出的文件是<code>t3</code>之后的数据。</p>
<p>为了确定事情是不是<code>t1</code>这次重启后发生，我又进行了一次确认。问题的原因是没有保存到<code>upload/团队ID/</code>下，而是直接保存到<code>团队ID/</code>下，可以通过正则表达式匹配<code>Saving it to 数字</code>的log，查看第一次出现这样的log的时间为<code>2021-07-16 09:24:28</code>，是在<code>t1</code>之后，所以可以确定原来的时间段是正确的，或者说，更详细的说是9点24-15点50之间的数据丢失了。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="logql" data-theme="default"><code data-language="logql" data-theme="default"><span class="line"><span style="color:#abb2bf">{container_name=&quot;backend&quot;}|~&quot;Saving it to [0-9]+&quot;</span></span></code></pre></div>
<p><figure><img alt="第一次保存错目录的log" loading="lazy" width="1581" height="797" decoding="async" data-nimg="1" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/first-bad-log.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-a-file-lost-accident/first-bad-log.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/first-bad-log.png?width=3840"/><figcaption class="text-center">第一次保存错目录的log</figcaption></figure></p>
<p>把查询时间设置在<code>t1</code>到<code>t3</code>之间，运行以下语句，通过正则表达式，提取在这期间上传的团队的ID，获得了一个团队ID的列表。那么这些就是受到本次影响的团队了。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="logql" data-theme="default"><code data-language="logql" data-theme="default"><span class="line"><span style="color:#abb2bf">{container_name=&quot;backend&quot;}|~&quot;Saving it to [0-9]+&quot; | regexp &quot;Saving it to (?P&lt;id&gt;[0-9]+)&quot; | line_format &quot;{{.id}}&quot;</span></span></code></pre></div>
<h1 id="后续处理"><a href="#后续处理" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>后续处理</h1>
<p>第一步当然是恢复还能恢复的文件并火速修改bug，并确认了一下在修改bug发布之前没有团队上传了新的文件。</p>
<p>由于这些文件无法被恢复，只能麻烦组委会其他人去通过电话、短信和邮件联系对应参赛队员，让他们重新交一份文件。</p>
<h1 id="出错原因"><a href="#出错原因" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>出错原因</h1>
<p>这次项目我给后端项目写了测试，覆盖率已经达到了94.3%，对文件上传这部分也进行了重点的测试，但是为什么还是没有发现这个问题呢？</p>
<p><figure><img alt="后端测试覆盖" loading="lazy" width="679" height="84" decoding="async" data-nimg="1" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/test-coverage.png?width=750 1x, /articles/asset/contents/20210721-summary-of-a-file-lost-accident/test-coverage.png?width=1920 2x" src="/articles/asset/contents/20210721-summary-of-a-file-lost-accident/test-coverage.png?width=1920"/><figcaption class="text-center">后端测试覆盖</figcaption></figure></p>
<p>因为之前我之前都是通过以下代码，将配置中的<code>config.upload.path</code>（取值为<code>upload</code>，就是之前根目录）和团队ID和文件名拼接起来，来获得一个团队的上传的文件的实际路径。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="diff" data-theme="default"><code data-language="diff" data-theme="default"><span class="line"><span style="color:#ABB2BF">diff --git a/backend/src/entities/Team.ts b/backend/src/entities/Team.ts</span></span>
<span class="line"><span style="color:#ABB2BF">index 38c381b..cf2957a 100644</span></span>
<span class="line"><span style="color:#61AFEF">--- a/backend/src/entities/Team.ts</span></span>
<span class="line"><span style="color:#61AFEF">+++ b/backend/src/entities/Team.ts</span></span>
<span class="line"><span style="color:#ABB2BF">@@ -1,4 +1,3 @@</span></span>
<span class="line"><span style="color:#E06C75">-import { config } from &quot;@/utils/config&quot;;</span></span>
<span class="line"><span style="color:#ABB2BF"> import { EntityOrRef, toRef } from &quot;@/utils/orm&quot;;</span></span>
<span class="line"><span style="color:#ABB2BF"> import {</span></span>
<span class="line"><span style="color:#ABB2BF">   ArrayType, Collection, Entity, IdentifiedReference,</span></span>
<span class="line"><span style="color:#ABB2BF">@@ -66,7 +65,7 @@ export class Team {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">   get filePath() {</span></span>
<span class="line"><span style="color:#ABB2BF">     return this.filename</span></span>
<span class="line"><span style="color:#E06C75">-      ? urljoin(config.upload.path, this.id + &quot;&quot;, this.filename)</span></span>
<span class="line"><span style="color:#98C379">+      ? urljoin(this.id + &quot;&quot;, this.filename)</span></span>
<span class="line"><span style="color:#ABB2BF">       : undefined;</span></span>
<span class="line"><span style="color:#ABB2BF">   }</span></span></code></pre></div>
<p>这次错误的commit为了重构<strong>下载</strong>的相关代码，修改了这个地方的计算逻辑，把拼接<code>config.upload.path</code>的代码移到了处理下载请求的代码中，而忘记了<strong>上传</strong>时确定文件保存的路径时也使用了这个<code>filePath</code> getter，造成了上传时使用的路径不包含顶级的<code>config.upload.path</code>，而是直接就是<code>{团队ID}/文件名</code>。</p>
<p>而在测试中，判断上传之后的文件是否存在时，仍然是使了<code>filePath</code> getter获得路径，这使得其实不管<code>filePath</code>怎么写，测试肯定都能通过，因为测试代码和业务代码所使用的计算路径的代码是相同的，所以并没有发现目录计算错误这个问题。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="ts" data-theme="default"><code data-language="ts" data-theme="default"><span class="line"><span style="color:#7F848E;font-style:italic">// 测试文件是否存在</span></span>
<span class="line"><span style="color:#61AFEF">expect</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">path</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">basename</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">t</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">filePath</span><span style="color:#56B6C2">!</span><span style="color:#ABB2BF">)).</span><span style="color:#61AFEF">toBe</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">newFileName</span><span style="color:#ABB2BF">);</span></span></code></pre></div>
<h1 id="教训"><a href="#教训" class="mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>教训</h1>
<ol>
<li>实现依赖业务，而非业务依赖实现</li>
</ol>
<p>之前把计算文件真实路径的代码放在业务模型里（<code>filePath</code>属性）这样的设计是有问题的。</p>
<p>按照DDD的思想，<strong>业务逻辑</strong>（保存用户上传的文件）不应该直接依赖<strong>实现逻辑</strong>（通过<code>config.upload.path</code>计算实际路径，然后使用<code>fs</code>直接操作文件系统），而是应该反过来，实现层面依赖业务逻辑。也就是说，应该</p>
<blockquote>
<p>提供一个保存用户文件的方法，这个方法接受保存文件所需要参数（比如操作用户、文件名、文件流），这个方法来负责进行实际保存文件的工作。</p>
</blockquote>
<p>用传统的OO和DI的说法，就是定义一个保存文件的接口，实现层实现实际的保存文件的逻辑，并通过DI注入给用户逻辑。业务逻辑通过这个接口完成保存文件的工作。</p>
<p>这样，既可以避免本文这种问题，还有利于以后进行扩展，比如不保存到本地，而是保存到云端的存储。</p>
<ol start="2">
<li>重视测试细节</li>
</ol>
<p>虽然这次写的测试并没有发现这个问题，但是现在复盘发现，如果在运行测试的时候能够留意并重视一个细节的话，仍然也可以发现这个错误。</p>
<p>测试结束后的运行的代码（<code>afterEach</code>）中，指定了删除<code>config.upload.path</code>的目录。</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="ts" data-theme="default"><code data-language="ts" data-theme="default"><span class="line"><span style="color:#61AFEF">afterEach</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">async</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">await</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">server</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">close</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#7F848E;font-style:italic">// delete the test upload path</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">await</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">fs</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">promises</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">rmdir</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">config</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">upload</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">path</span><span style="color:#ABB2BF">, { </span><span style="color:#E06C75">recursive</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF"> });</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#7F848E;font-style:italic">// ...</span></span>
<span class="line"><span style="color:#ABB2BF">});</span></span></code></pre></div>
<p>但是由于错误的代码没有写到这个目录中，删除<code>config.upload.path</code>并不能删除测试上传所创建的文件，那么跑完测试将会有新的文件生成，就像下面这样：</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="default"><code data-language="bash" data-theme="default"><span class="line"><span style="color:#61AFEF">➜</span><span style="color:#ABB2BF">  </span><span style="color:#98C379">git</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">status</span></span>
<span class="line"><span style="color:#61AFEF">On</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">branch</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">master</span></span>
<span class="line"><span style="color:#61AFEF">Your</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">branch</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">is</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">up</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">to</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">date</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">with</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&#x27;origin/master&#x27;.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">Untracked</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">files:</span></span>
<span class="line"><span style="color:#ABB2BF">  (</span><span style="color:#61AFEF">use</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;git add &lt;file&gt;...&quot;</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">to</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">include</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">in</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">what</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">will</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">be</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">committed</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">10/</span></span></code></pre></div>
<p>现在我想起来，当时确实发现了这个问题，但是并没有引起重视。</p>
<ol start="3">
<li>log中记录尽可能多的信息</li>
</ol>
<p>从上面的发现问题的过程中可以发现，log相当重要。要是log中没有记录真实的完整路径，我可能需要花更多时间才能明白问题的原因。要是没有对每次文件保存都打log，我甚至都不能知道哪些队伍受到了影响。log记录了系统运行的整个流程，是分析系统的运行流程的最准确的工具。如果log打得好的话，能够从log中提取出很多没有记录到数据库中的数据。</p>
<p>所以应该在log里尽可能记录更多的信息。最基本的，错误必须打到log中，不能直接吞掉。而且在进行一些容易出错的行为时，也应该尽可能把相关上下文打到log里，以供后续查找。</p></div><div class="hidden lg:block lg:w-[25%]"><div class="px-1 sticky top-24"><ul class="menu max-w-full overflow-auto"><li><div class="menu-title flex space-x-1 items-center py-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"></path></svg><span>目录</span></div><ul class="menu"><li style="padding-left:0"><a id="tocitem-生产事故" href="#生产事故">生产事故</a></li><li style="padding-left:0"><a id="tocitem-tldr" href="#tldr">TL;DR</a></li><li style="padding-left:0"><a id="tocitem-问题发现" href="#问题发现">问题发现</a></li><li style="padding-left:0"><a id="tocitem-确定影响范围和补救" href="#确定影响范围和补救">确定影响范围和补救</a></li><li style="padding-left:0"><a id="tocitem-后续处理" href="#后续处理">后续处理</a></li><li style="padding-left:0"><a id="tocitem-出错原因" href="#出错原因">出错原因</a></li><li style="padding-left:0"><a id="tocitem-教训" href="#教训">教训</a></li></ul></li></ul></div></div></div></div><div class="max-w-7xl mx-auto p-4"><div><h2 class="text-2xl font-bold mb-2 flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg><span class="mx-2">相关文章</span></h2><div class="flex flex-wrap gap-2"><div class="card w-96 bg-base-100 shadow-lg hover:shadow-xl transition"><div class="card-body"><span class="text-sm">2021-07-21 16:34:00 UTC+8</span><a href="/articles/summary-of-my-first-real-project/cn"><h2 class="card-title">我的第一个真实项目：总结和经验</h2></a><p>
# 我的第一个真实项目

终于，从3月15日开始，我自己独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作：https://data-competition.pku.edu.cn ，</p></div></div></div></div></div><div class="max-w-7xl mx-auto p-4"><div><h2 class="text-2xl font-bold mb-2 flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg><span class="mx-2"> 评论</span></h2></div></div></div></article></div><footer class="bg-base-200 text-base-content"><div class="footer py-6 max-w-7xl mx-auto px-4"><div class="space-y-1"><p>👨🏼‍💻 <!-- -->本网站由<a class="link link-hover" href="/about/me/cn">ddadaal</a>自豪地编写</p><p>📝<!-- -->本站文章在<a rel="licene noreferrer" target="_blank" class="link" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>协议下授权</p><div class="tooltip" data-tip="2018-11-17 06:51:00 UTC+0"><p>📅 <!-- -->博客已经运行 <span class="countdown"><span style="--value:4"></span></span> 年 <span class="countdown"><span style="--value:6"></span></span> 月 <span class="countdown"><span style="--value:27"></span></span> 天 <span class="countdown"><span style="--value:19"></span></span> 时 <span class="countdown"><span style="--value:57"></span></span> 分 <span class="countdown"><span style="--value:38"></span></span> 秒</p></div><p>⏲️ <!-- -->最后更新<!-- -->:  <!-- -->2023-06-12 02:48:38 UTC+0</p><div><p>📲 <!-- -->联系我</p><div class="flex py-2 gap-2"><span><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=540232834&amp;site=qq&amp;menu=yes" title="QQ: 540232834" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"></path></svg></a></span><span><a href="mailto://ddadaal.me@outlook.com" title="E-mail: ddadaal@outlook.com" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z"></path></svg></a></span><span><a href="https://www.linkedin.com/in/chenjunda/" title="LinkedIn: 陈俊达" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></span><span><a href="https://github.com/ddadaal" title="GitHub: ddadaal" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></span><span><a href="https://steamcommunity.com/profiles/76561198104889782" title="Steam: Victor Crubs" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z"></path></svg></a></span><span><a href="https://zhihu.com/people/VicCrubs" title="知乎：陈俊达" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"></path></svg></a></span><span><a href="https://www.douban.com/people/183064260/" title="豆瓣: ddadaal" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z"></path></svg></a></span></div></div><p class="text-center">© <!-- -->2023<!-- --> | <!-- -->用 ❤ 制作</p></div><div><span class="footer-title">🚀 <!-- -->强力驱动</span><a class="link link-hover" target="_blank" href="https://reactjs.org/" rel="noreferrer">React</a><a class="link link-hover" target="_blank" href="https://www.gatsbyjs.org/" rel="noreferrer">Next.js</a><a class="link link-hover" target="_blank" href="https://pages.github.com/" rel="noreferrer">GitHub Pages</a><a class="link link-hover" target="_blank" href="https://www.typescriptlang.org/" rel="noreferrer">TypeScript</a></div><div><span class="footer-title">🎨 <!-- -->描绘主题</span><a class="link link-hover" target="_blank" href="https://reactstrap.github.io/" rel="noreferrer">daisyui</a><a class="link link-hover" target="_blank" href="https://bootswatch.com/flatly/" rel="noreferrer">tailwind</a></div><div><span class="footer-title">🎓 <!-- -->联系我</span><a class="link link-hover" target="_blank" href="https://idealclover.top" rel="noreferrer">idealclover - 翠翠酱的个人网站</a><a class="link link-hover" target="_blank" href="https://sephidator.xyz" rel="noreferrer">Sephidator - Sephidator的个人博客</a><a class="link link-hover" target="_blank" href="https://iznauy.github.io/" rel="noreferrer">iznauy - 个人博客</a><a class="link link-hover" target="_blank" href="https://aironoria.github.io" rel="noreferrer">Aironoria - 陈俊宇的个人博客</a><a class="link link-hover" target="_blank" href="https://jbesu.com/" rel="noreferrer">forewing - 个人主页</a><a class="link link-hover" target="_blank" href="https://weiser.fun" rel="noreferrer">Weiser - 个人主页</a></div></div></footer><script src="/_next/static/chunks/webpack-712082f7b34df088.js" async=""></script><script src="/_next/static/chunks/9fed808d-69a30961282abef4.js" async=""></script><script src="/_next/static/chunks/890-9e3be26fb7cfc3a1.js" async=""></script><script src="/_next/static/chunks/main-app-bca969b2b4dec788.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/3cd875c779557762.css\",{\"as\":\"style\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/c61fd82c0ec3c846.css\",{\"as\":\"style\"}]\n4:HL[\"/_next/static/css/550cc6711c036586.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"5:I{\"id\":\"7335\",\"chunks\":[\"272:static/chunks/webpack-712082f7b34df088.js\",\"159:static/chunks/9fed808d-69a30961282abef4.js\",\"890:static/chunks/890-9e3be26fb7cfc3a1.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":\"5\",\"chunks\":[\"272:static/chunks/webpack-712082f7b34df088.js\",\"159:static/chunks/9fed808d-69a30961282abef4.js\",\"890:static/chunks/890-9e3be26fb7cfc3a1.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3cd875c779557762.css\",\"precedence\":\"next\"}]],[\"$\",\"$L5\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/articles/summary-of-a-file-lost-accident\",\"initialTree\":[\"\",{\"children\":[\"articles\",{\"children\":[[\"params\",\"summary-of-a-file-lost-accident\",\"oc\"],{\"children\":[\"__PAGE__?{\\\"params\\\":[\\\"summary-of-a-file-lost-accident\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$L6\",null],\"globalErrorComponent\":\"$7\",\"notFound\":\"$L8\",\"asNotFound\":false,\"children\":[\"$L9\",null]}]]\n"])</script><script>self.__next_f.push([1,"a:I{\"id\":\"686\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"259:static/chunks/259-a47cae28ff3a0878.js\",\"185:static/chunks/app/layout-ae9ef496e3b2e00e.js\"],\"name\":\"RootLayout\",\"async\":false}\nb:I{\"id\":\"1895\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"259:static/chunks/259-a47cae28ff3a0878.js\",\"185:static/"])</script><script>self.__next_f.push([1,"chunks/app/layout-ae9ef496e3b2e00e.js\"],\"name\":\"Header\",\"async\":false}\nc:I{\"id\":\"9311\",\"chunks\":[\"272:static/chunks/webpack-712082f7b34df088.js\",\"159:static/chunks/9fed808d-69a30961282abef4.js\",\"890:static/chunks/890-9e3be26fb7cfc3a1.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"6467\",\"chunks\":[\"272:static/chunks/webpack-712082f7b34df088.js\",\"159:static/chunks/9fed808d-69a30961282abef4.js\",\"890:static/chunks/890-9e3be26fb7cfc3a1.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":\"5707\",\"chunks\":[\"309:static/chunks/70bb1395-1"])</script><script>self.__next_f.push([1,"9ca908277f9fed9.js\",\"975:static/chunks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691073cd158eaece.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"Localized\",\"async\":false}\n10:I{\"id\":\"4375\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"975:static/chunks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691"])</script><script>self.__next_f.push([1,"073cd158eaece.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"LocalizedArticleLink\",\"async\":false}\n11:I{\"id\":\"5298\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"259:static/chunks/259-a47cae28ff3a0878.js\",\"185:static/chunks/app/layout-ae9ef49"])</script><script>self.__next_f.push([1,"6e3b2e00e.js\"],\"name\":\"RunningTime\",\"async\":false}\n12:I{\"id\":\"4926\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"259:static/chunks/259-a47cae28ff3a0878.js\",\"185:static/chunks/app/layout-ae9ef496e3b2e00e.js\"],\"name\":\"LastUpdateTime\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"$La\",null,{\"children\":[[\"$\",\"$Lb\",null,{\"resumeLangs\":[\"cn\",\"en\"]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\",[\"params\",\"summary-of-a-file-lost-accident\",\"oc\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Le\",null],\"segment\":\"__PAGE__?{\\\"params\\\":[\\\"summary-of-a-file-lost-accident\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c61fd82c0ec3c846.css\",\"precedence\":\"next\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/550cc6711c036586.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"params\",\"summary-of-a-file-lost-accident\",\"oc\"]},\"styles\":[]}],\"segment\":\"articles\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"bg-base-200 text-base-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"footer py-6 max-w-7xl mx-auto px-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"👨🏼‍💻 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.codeBy\",\"args\":[[\"$\",\"$L10\",\"about/me\",{\"className\":\"link link-hover\",\"basePath\":\"/about/me\",\"children\":\"ddadaal\"}]]}]]}],[\"$\",\"p\",null,{\"children\":[\"📝\",[\"$\",\"$Lf\",null,{\"id\":\"footer.license\",\"args\":[[\"$\",\"a\",\"license\",{\"rel\":\"licene noreferrer\",\"target\":\"_blank\",\"className\":\"link\",\"href\":\"https://creativecommons.org/licenses/by-sa/4.0/\",\"children\":\"CC BY-SA 4.0\"}]]}]]}],[\"$\",\"$L11\",null,{\"serverStartTime\":\"2023-06-12T02:48:38.431+00:00\"}],[\"$\",\"$L12\",null,{\"time\":\"2023-06-12T02:48:38.431+00:00\"}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"📲 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.contacts\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex py-2 gap-2\",\"children\":[[\"$\",\"span\",\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",{\"children\":[\"$\",\"a\",null,{\"href\":\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",\"title\":\"QQ: 540232834\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"mailto://ddadaal.me@outlook.com\",{\"children\":[\"$\",\"a\",null,{\"href\":\"mailto://ddadaal.me@outlook.com\",\"title\":\"E-mail: ddadaal@outlook.com\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 576 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.linkedin.com/in/chenjunda/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/chenjunda/\",\"title\":\"LinkedIn: 陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://github.com/ddadaal\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/ddadaal\",\"title\":\"GitHub: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://steamcommunity.com/profiles/76561198104889782\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://steamcommunity.com/profiles/76561198104889782\",\"title\":\"Steam: Victor Crubs\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://zhihu.com/people/VicCrubs\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://zhihu.com/people/VicCrubs\",\"title\":\"知乎：陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 640 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.douban.com/people/183064260/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.douban.com/people/183064260/\",\"title\":\"豆瓣: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"role\":\"img\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$undefined\",[[\"$\",\"title\",\"0\",{\"children\":[]}],[\"$\",\"path\",\"1\",{\"d\":\"M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"text-center\",\"children\":[\"© \",2023,\" | \",[\"$\",\"$Lf\",null,{\"id\":\"footer.madeWithLove\"}]]}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🚀 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.poweredBy\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://reactjs.org/\",\"rel\":\"noreferrer\",\"children\":\"React\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://www.gatsbyjs.org/\",\"rel\":\"noreferrer\",\"children\":\"Next.js\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://pages.github.com/\",\"rel\":\"noreferrer\",\"children\":\"GitHub Pages\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://www.typescriptlang.org/\",\"rel\":\"noreferrer\",\"children\":\"TypeScript\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎨 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.themedWith\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://reactstrap.github.io/\",\"rel\":\"noreferrer\",\"children\":\"daisyui\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://bootswatch.com/flatly/\",\"rel\":\"noreferrer\",\"children\":\"tailwind\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎓 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.contacts\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://idealclover.top\",\"rel\":\"noreferrer\",\"children\":\"idealclover - 翠翠酱的个人网站\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://sephidator.xyz\",\"rel\":\"noreferrer\",\"children\":\"Sephidator - Sephidator的个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://iznauy.github.io/\",\"rel\":\"noreferrer\",\"children\":\"iznauy - 个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://aironoria.github.io\",\"rel\":\"noreferrer\",\"children\":\"Aironoria - 陈俊宇的个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://jbesu.com/\",\"rel\":\"noreferrer\",\"children\":\"forewing - 个人主页\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://weiser.fun\",\"rel\":\"noreferrer\",\"children\":\"Weiser - 个人主页\"}]]]}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"$La\",null,{\"children\":[[\"$\",\"$Lb\",null,{\"resumeLangs\":[\"cn\",\"en\"]}],[\"$\",\"div\",null,{\"children\":[\"$L13\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}],[\"$\",\"footer\",null,{\"className\":\"bg-base-200 text-base-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"footer py-6 max-w-7xl mx-auto px-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"👨🏼‍💻 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.codeBy\",\"args\":[[\"$\",\"$L10\",\"about/me\",{\"className\":\"link link-hover\",\"basePath\":\"/about/me\",\"children\":\"ddadaal\"}]]}]]}],[\"$\",\"p\",null,{\"children\":[\"📝\",[\"$\",\"$Lf\",null,{\"id\":\"footer.license\",\"args\":[[\"$\",\"a\",\"license\",{\"rel\":\"licene noreferrer\",\"target\":\"_blank\",\"className\":\"link\",\"href\":\"https://creativecommons.org/licenses/by-sa/4.0/\",\"children\":\"CC BY-SA 4.0\"}]]}]]}],[\"$\",\"$L11\",null,{\"serverStartTime\":\"2023-06-12T02:48:38.431+00:00\"}],[\"$\",\"$L12\",null,{\"time\":\"2023-06-12T02:48:38.431+00:00\"}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"📲 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.contacts\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex py-2 gap-2\",\"children\":[[\"$\",\"span\",\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",{\"children\":[\"$\",\"a\",null,{\"href\":\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",\"title\":\"QQ: 540232834\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"mailto://ddadaal.me@outlook.com\",{\"children\":[\"$\",\"a\",null,{\"href\":\"mailto://ddadaal.me@outlook.com\",\"title\":\"E-mail: ddadaal@outlook.com\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 576 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.linkedin.com/in/chenjunda/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/chenjunda/\",\"title\":\"LinkedIn: 陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://github.com/ddadaal\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/ddadaal\",\"title\":\"GitHub: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://steamcommunity.com/profiles/76561198104889782\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://steamcommunity.com/profiles/76561198104889782\",\"title\":\"Steam: Victor Crubs\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://zhihu.com/people/VicCrubs\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://zhihu.com/people/VicCrubs\",\"title\":\"知乎：陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 640 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.douban.com/people/183064260/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.douban.com/people/183064260/\",\"title\":\"豆瓣: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"role\":\"img\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$undefined\",[[\"$\",\"title\",\"0\",{\"children\":[]}],[\"$\",\"path\",\"1\",{\"d\":\"M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"text-center\",\"children\":[\"© \",2023,\" | \",[\"$\",\"$Lf\",null,{\"id\":\"footer.madeWithLove\"}]]}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🚀 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.poweredBy\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://reactjs.org/\",\"rel\":\"noreferrer\",\"children\":\"React\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://www.gatsbyjs.org/\",\"rel\":\"noreferrer\",\"children\":\"Next.js\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://pages.github.com/\",\"rel\":\"noreferrer\",\"children\":\"GitHub Pages\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://www.typescriptlang.org/\",\"rel\":\"noreferrer\",\"children\":\"TypeScript\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎨 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.themedWith\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://reactstrap.github.io/\",\"rel\":\"noreferrer\",\"children\":\"daisyui\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://bootswatch.com/flatly/\",\"rel\":\"noreferrer\",\"children\":\"tailwind\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎓 \",[\"$\",\"$Lf\",null,{\"id\":\"footer.contacts\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://idealclover.top\",\"rel\":\"noreferrer\",\"children\":\"idealclover - 翠翠酱的个人网站\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://sephidator.xyz\",\"rel\":\"noreferrer\",\"children\":\"Sephidator - Sephidator的个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://iznauy.github.io/\",\"rel\":\"noreferrer\",\"children\":\"iznauy - 个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://aironoria.github.io\",\"rel\":\"noreferrer\",\"children\":\"Aironoria - 陈俊宇的个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://jbesu.com/\",\"rel\":\"noreferrer\",\"children\":\"forewing - 个人主页\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://weiser.fun\",\"rel\":\"noreferrer\",\"children\":\"Weiser - 个人主页\"}]]]}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"6:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],[\"$\",\"title\",null,{\"children\":\"一次生产环境的文件丢失事故：复盘和教训 - ddadaal.me\"}],[\"$\",\"meta\",null,{\"name\":\"description\",\"content\":\"ddadaal's personal website\"}],null,null,[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/site.webmanifest\"}],null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/icon.svg?35be8e76be1c3618\",\"type\":\"image/svg+xml\",\"sizes\":\"500x500\"}]],[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?5334a64f42000bb0\",\"type\":\"image/png\",\"sizes\":\"180x180\"}]],null]]\n"])</script><script>self.__next_f.push([1,"e:\"$L14\"\n13:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],null,null,null,null,null,null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,null]\n"])</script><script>self.__next_f.push([1,"15:I{\"id\":\"6091\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"975:static/chunks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691073cd158eaece.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"ArticleFrontmatter\",\"async\":false}\n17:I{\"id\":\"3303\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"975:static/chu"])</script><script>self.__next_f.push([1,"nks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691073cd158eaece.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"RelatedArticles\",\"async\":false}\n18:I{\"id\":\"1763\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"975:static/chunks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691073cd158eaece.js\",\"813:static"])</script><script>self.__next_f.push([1,"/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"CommentPanelWithCurrentLanguage\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"bg-neutral px-4 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col animate-slide-up\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl my-2\",\"children\":\"一次生产环境的文件丢失事故：复盘和教训\"}],[\"$\",\"$L15\",null,{\"className\":\"justify-center\",\"articleId\":\"summary-of-a-file-lost-accident\",\"info\":{\"content\":\"\\n# 生产事故\\n\\n我最近负责了一个比赛后台网站的开发和维护，在比赛临近结束、正在接受用户提交成果文件的时候出了一场生产事故，造成了丢失了一段时间内用户上传的文件。本文主要讲讲生产事故从发现到确定影响范围到确定原因的过程。在整个过程中，后台程序记录的日志起到了巨大的作用。\\n\\n关于这个项目的总结，可以查看这篇文章：[我的第一个真实项目：总结和经验](/articles/summary-of-my-first-real-project)。\\n\\n# TL;DR\\n\\n| 要素     | 内容                                                                                                   |\\n| -------- | ------------------------------------------------------------------------------------------------------ |\\n| 表现     | 丢失`2021-07-16 09:00:10`至`2021-07-17 18:00:57`期间所上传的文件                                       |\\n| 原因     | 7月16日的一次提交，使得之后文件上传到了一个容器内部的、没有mount出来的目录，容器重启后，这些文件丢失了 |\\n| 补救     | 进入容器，找回了最后一次容器重启后到问题发生期间上传的文件                                             |\\n| 后续处理 | 通过log、数据库数据等找到了受到影响的用户，通过邮箱、电话和短信提醒他们重新上传文件                    |\\n| 经验     | 实现依赖业务，而非业务依赖实现；重视测试细节；log中记录尽可能多的信息                                  |\\n\\n# 问题发现\\n\\n项目基本情况是这样的。用户可以注册团队，一个团队有一个队长，队长可以提交一个团队的成果文件。管理员可以看到各个队伍的提交情况，以及也可以直接下载团队提交的文件。\\n\\n19日下午4点左右，我用管理员登录了系统，本来只是在随便看看有哪些团队提交了成果，结果突然发现有的团队的成果点击下载下不下来。\\n\\n![点击下载提交的团队的成果发现出错](download-error.png)\\n\\n赶紧上服务器上看是怎么回事。打开服务器存放上传的文件的目录，grep一下发现对应的ID发现没有这个文件。\\n\\n上传文件的逻辑是这样的：\\n\\n1. 获取上传的文件\\n2. 把文件保存到`upload/{团队ID}/文件名`\\n   1. 保存之前，打日志`Received file {文件名} from {用户ID}. Saving it to {完整路径}.`\\n   2. 保存完成后，打日志`${完整路径} saved successfully.`\\n3. 更新数据库，记录文件名(列名为`filename`)和上传时间（`last_update_time`）\\n\\n如果第二步失败，就不能进行第三步，不会出现保存文件失败但是写了数据库的情况。但是如果没有写数据库，我在后台就不会看到这个团队有成果，就不会能够点击下载了。\\n\\n后端程序运行在docker中，但是`upload`是一个mounted volume，其中的文件和容器外的一个目录是进行了共享的，所以不管容器怎么重启，这里面的文件是不会掉的。\\n\\n```yaml\\n# docker-compose相关部分, /dist是容器中存放程序文件的根目录\\nbackend:\\n  volumes:\\n    - \\\"./backend/upload:/dist/upload\\\"\\n```\\n\\n马上翻了下日志，按上面说的格式搜一下日志（下面的队伍ID为实际的团队ID）：\\n\\n```logql\\n{container_name=\\\"backend\\\"}|=\\\"Saving it to upload/队伍ID\\\"\\n```\\n\\n发现**没有结果**。\\n\\n这就奇怪了，于是把`upload/队伍ID`从查询语句中删除，直接看有哪些保存的日志，这一看就出事了。我看到了一堆这样的日志：\\n\\n```\\n{\\\"level\\\":30,\\\"time\\\":1626528267191,\\\"pid\\\":36,\\\"hostname\\\":\\\"2358983e224d\\\",\\\"reqId\\\":\\\"req-29\\\",\\\"msg\\\":\\\"Received file 文件名.zip from 用户ID.\\\\n    Saving it to 团队ID/文件名.zip.\\\"}\\n```\\n\\n文件被保存到`{团队ID}/文件名`下了！而`{团队ID}`这些目录是没有被mount的，容器重启就重启了，没了！\\n\\n马上进入容器里运行`ls`，果然在容器根目录看到了一堆`{团队ID}`的目录。\\n\\n# 确定影响范围和补救\\n\\n首先，我把容器里已有的这些文件复制了出来，并定时检查有没有新的文件。还好，在排查问题的整个过程中都没有新的文件名上传。这些文件应该是在上一次容器重启之后才上传的。\\n\\n之后，是找到哪些队伍的文件仍然丢失了，也就是数据库中`filename`不是NULL，但是`upload`下面没有这个队伍。这些队伍的文件应该是在上一次重启之前就上传了，上一次重启使得这些文件丢失了，应该是无法找回了。\\n\\n通过各种查找资料，写出来以下的bash脚本：\\n\\n```bash\\n# 查询filename不是NULL的团队的ID，写入db.txt\\nquery=\\\"\\\"\\\"\\nuse data_competition_prod;\\nselect id from team where filename is not null;\\n\\\"\\\"\\\"\\necho $query | mysql -u root -h 127.0.0.1 -P 3306 -p密码 | sed '1d' | sort -n \u003e db.txt\\n\\n# 查询upload下的所有目录名，写入folder.txt\\nls -d */ | cut -f1 -d'/' | sort -n \u003e folder.txt\\n\\n# diff两个文件\\ndiff db.txt folder.txt\\n```\\n\\n这个bash脚本得出filename不是NULL的、但是upload下没有对应的目录有**11**个。所以这11个团队的文件是丢失了。\\n\\n但是除了丢失文件的情况，还有在出现问题之前就上传了版本，但是在这问题发生后更新了文件。这样，虽然在系统上有他们的问题，但是这些文件版本不是最终的版本。\\n\\n为了找到这些团队，首先需要找到最近几次重启的时间，以及问题开始时的时间。容器重启的时候之前的容器会被强制退出，会打出有`npm ERR`的日志，通过这个ERR可以找到最近几次重启的时间。\\n\\n```logql\\n{container_name=\\\"backend\\\"}|=\\\"npm ERR\\\"\\n```\\n\\n![最近几次重启的时间](reboot-logs.png)\\n\\n可以看到图上有三次重启：\\n\\n- `2021-07-16 09:00:10` (`t1`)\\n- `2021-07-16 15:50:07`\\n- `2021-07-17 18:00:57` (`t3`)\\n\\n最后一次重启（19日的）是后面修改代码中的bug引发的重启，此时文件能恢复的文件已经恢复。而查询时间段之前的代码我知道是没有问题的。所以可以确定，`t1`-`t3`之间的数据是丢失了，而我之前从容器中补救出的文件是`t3`之后的数据。\\n\\n为了确定事情是不是`t1`这次重启后发生，我又进行了一次确认。问题的原因是没有保存到`upload/团队ID/`下，而是直接保存到`团队ID/`下，可以通过正则表达式匹配`Saving it to 数字`的log，查看第一次出现这样的log的时间为`2021-07-16 09:24:28`，是在`t1`之后，所以可以确定原来的时间段是正确的，或者说，更详细的说是9点24-15点50之间的数据丢失了。\\n\\n```logql\\n{container_name=\\\"backend\\\"}|~\\\"Saving it to [0-9]+\\\"\\n```\\n\\n![第一次保存错目录的log](first-bad-log.png)\\n\\n把查询时间设置在`t1`到`t3`之间，运行以下语句，通过正则表达式，提取在这期间上传的团队的ID，获得了一个团队ID的列表。那么这些就是受到本次影响的团队了。\\n\\n```logql\\n{container_name=\\\"backend\\\"}|~\\\"Saving it to [0-9]+\\\" | regexp \\\"Saving it to (?P\u003cid\u003e[0-9]+)\\\" | line_format \\\"{{.id}}\\\"\\n```\\n\\n# 后续处理\\n\\n第一步当然是恢复还能恢复的文件并火速修改bug，并确认了一下在修改bug发布之前没有团队上传了新的文件。\\n\\n由于这些文件无法被恢复，只能麻烦组委会其他人去通过电话、短信和邮件联系对应参赛队员，让他们重新交一份文件。\\n\\n# 出错原因\\n\\n这次项目我给后端项目写了测试，覆盖率已经达到了94.3%，对文件上传这部分也进行了重点的测试，但是为什么还是没有发现这个问题呢？\\n\\n![后端测试覆盖](test-coverage.png)\\n\\n因为之前我之前都是通过以下代码，将配置中的`config.upload.path`（取值为`upload`，就是之前根目录）和团队ID和文件名拼接起来，来获得一个团队的上传的文件的实际路径。\\n\\n\\n```diff\\ndiff --git a/backend/src/entities/Team.ts b/backend/src/entities/Team.ts\\nindex 38c381b..cf2957a 100644\\n--- a/backend/src/entities/Team.ts\\n+++ b/backend/src/entities/Team.ts\\n@@ -1,4 +1,3 @@\\n-import { config } from \\\"@/utils/config\\\";\\n import { EntityOrRef, toRef } from \\\"@/utils/orm\\\";\\n import {\\n   ArrayType, Collection, Entity, IdentifiedReference,\\n@@ -66,7 +65,7 @@ export class Team {\\n\\n   get filePath() {\\n     return this.filename\\n-      ? urljoin(config.upload.path, this.id + \\\"\\\", this.filename)\\n+      ? urljoin(this.id + \\\"\\\", this.filename)\\n       : undefined;\\n   }\\n```\\n\\n这次错误的commit为了重构**下载**的相关代码，修改了这个地方的计算逻辑，把拼接`config.upload.path`的代码移到了处理下载请求的代码中，而忘记了**上传**时确定文件保存的路径时也使用了这个`filePath` getter，造成了上传时使用的路径不包含顶级的`config.upload.path`，而是直接就是`{团队ID}/文件名`。\\n\\n而在测试中，判断上传之后的文件是否存在时，仍然是使了`filePath` getter获得路径，这使得其实不管`filePath`怎么写，测试肯定都能通过，因为测试代码和业务代码所使用的计算路径的代码是相同的，所以并没有发现目录计算错误这个问题。\\n\\n```ts\\n// 测试文件是否存在\\nexpect(path.basename(t.filePath!)).toBe(newFileName);\\n```\\n\\n# 教训\\n\\n1. 实现依赖业务，而非业务依赖实现\\n\\n之前把计算文件真实路径的代码放在业务模型里（`filePath`属性）这样的设计是有问题的。\\n\\n按照DDD的思想，**业务逻辑**（保存用户上传的文件）不应该直接依赖**实现逻辑**（通过`config.upload.path`计算实际路径，然后使用`fs`直接操作文件系统），而是应该反过来，实现层面依赖业务逻辑。也就是说，应该\\n\\n\u003e 提供一个保存用户文件的方法，这个方法接受保存文件所需要参数（比如操作用户、文件名、文件流），这个方法来负责进行实际保存文件的工作。\\n\\n用传统的OO和DI的说法，就是定义一个保存文件的接口，实现层实现实际的保存文件的逻辑，并通过DI注入给用户逻辑。业务逻辑通过这个接口完成保存文件的工作。\\n\\n这样，既可以避免本文这种问题，还有利于以后进行扩展，比如不保存到本地，而是保存到云端的存储。\\n\\n2. 重视测试细节\\n\\n虽然这次写的测试并没有发现这个问题，但是现在复盘发现，如果在运行测试的时候能够留意并重视一个细节的话，仍然也可以发现这个错误。\\n\\n测试结束后的运行的代码（`afterEach`）中，指定了删除`config.upload.path`的目录。\\n\\n```ts\\nafterEach(async () =\u003e {\\n  await server.close();\\n  // delete the test upload path\\n  await fs.promises.rmdir(config.upload.path, { recursive: true });\\n  // ...\\n});\\n```\\n\\n但是由于错误的代码没有写到这个目录中，删除`config.upload.path`并不能删除测试上传所创建的文件，那么跑完测试将会有新的文件生成，就像下面这样：\\n\\n```bash\\n➜  git status\\nOn branch master\\nYour branch is up to date with 'origin/master'.\\n\\nUntracked files:\\n  (use \\\"git add \u003cfile\u003e...\\\" to include in what will be committed)\\n        10/\\n```\\n\\n现在我想起来，当时确实发现了这个问题，但是并没有引起重视。\\n\\n3. log中记录尽可能多的信息\\n\\n从上面的发现问题的过程中可以发现，log相当重要。要是log中没有记录真实的完整路径，我可能需要花更多时间才能明白问题的原因。要是没有对每次文件保存都打log，我甚至都不能知道哪些队伍受到了影响。log记录了系统运行的整个流程，是分析系统的运行流程的最准确的工具。如果log打得好的话，能够从log中提取出很多没有记录到数据库中的数据。\\n\\n所以应该在log里尽可能记录更多的信息。最基本的，错误必须打到log中，不能直接吞掉。而且在进行一些容易出错的行为时，也应该尽可能把相关上下文打到log里，以供后续查找。\\n\",\"title\":\"一次生产环境的文件丢失事故：复盘和教训\",\"date\":\"2021-07-21 13:13\",\"id\":\"summary-of-a-file-lost-accident\",\"lang\":\"cn\",\"tags\":[\"problem-investigation\",\"project\"],\"related\":[\"summary-of-my-first-real-project\"],\"ignored_in_list\":\"$undefined\",\"hide_heading\":\"$undefined\",\"no_toc\":\"$undefined\",\"absolute_path\":\"$undefined\",\"last_updated\":\"$undefined\",\"wordCount\":3034,\"readingTime\":15.17,\"filePath\":\"contents/20210721-summary-of-a-file-lost-accident/cn.md\"},\"langVersions\":[\"cn\"]}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"animate-slide-up\",\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":\"$L16\"}],[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":[\"$\",\"$L17\",null,{\"relatedArticles\":[{\"id\":\"summary-of-my-first-real-project\",\"langVersions\":[{\"excerpt\":\"\\n# 我的第一个真实项目\\n\\n终于，从3月15日开始，我自己独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作：https://data-competition.pku.edu.cn ，\",\"lang\":\"cn\",\"time\":\"2021-07-21 16:34:00 UTC+8\",\"title\":\"我的第一个真实项目：总结和经验\",\"last_updated\":\"$undefined\",\"absolute_path\":\"$undefined\"}]}]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":[\"$\",\"$L18\",null,{\"articleId\":\"summary-of-a-file-lost-accident\",\"articleTitle\":\"一次生产环境的文件丢失事故：复盘和教训\"}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1d:I{\"id\":\"6707\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"975:static/chunks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691073cd158eaece.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"ArticleToc\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"div\",null,{\"className\":\"flex flex-row space-x-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-full lg:w-[75%]\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"生产事故\",\"children\":[[\"$\",\"a\",\"生产事故\",{\"href\":\"#生产事故\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"生产事故\"]]}],\"\\n\",[\"$\",\"p\",\"h-3\",{\"children\":[\"我最近负责了一个比赛后台网站的开发和维护，在比赛临近结束、正在接受用户提交成果文件的时候出了一场生产事故，造成了丢失了一段时间内用户上传的文件。本文主要讲讲生产事故从发现到确定影响范围到确定原因的过程。在整个过程中，后台程序记录的日志起到了巨大的作用。\"]}],\"\\n\",[\"$\",\"p\",\"h-4\",{\"children\":[\"关于这个项目的总结，可以查看这篇文章：\",[\"$\",\"a\",\"h-5\",{\"href\":\"/articles/summary-of-my-first-real-project\",\"children\":[\"我的第一个真实项目：总结和经验\"]}],\"。\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"tldr\",\"children\":[[\"$\",\"a\",\"tldr\",{\"href\":\"#tldr\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"TL;DR\"]]}],\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\",[\"$\",\"table\",\"h-7\",{\"children\":[[\"$\",\"thead\",\"h-8\",{\"children\":[[\"$\",\"tr\",\"h-9\",{\"children\":[[\"$\",\"th\",\"h-10\",{\"children\":[\"要素\"]}],[\"$\",\"th\",\"h-11\",{\"children\":[\"内容\"]}]]}]]}],[\"$\",\"tbody\",\"h-12\",{\"children\":[[\"$\",\"tr\",\"h-13\",{\"children\":[[\"$\",\"td\",\"h-14\",{\"children\":[\"表现\"]}],[\"$\",\"td\",\"h-15\",{\"children\":[\"丢失\",[\"$\",\"code\",\"h-16\",{\"children\":[\"2021-07-16 09:00:10\"]}],\"至\",[\"$\",\"code\",\"h-17\",{\"children\":[\"2021-07-17 18:00:57\"]}],\"期间所上传的文件\"]}]]}],[\"$\",\"tr\",\"h-18\",{\"children\":[[\"$\",\"td\",\"h-19\",{\"children\":[\"原因\"]}],[\"$\",\"td\",\"h-20\",{\"children\":[\"7月16日的一次提交，使得之后文件上传到了一个容器内部的、没有mount出来的目录，容器重启后，这些文件丢失了\"]}]]}],[\"$\",\"tr\",\"h-21\",{\"children\":[[\"$\",\"td\",\"h-22\",{\"children\":[\"补救\"]}],[\"$\",\"td\",\"h-23\",{\"children\":[\"进入容器，找回了最后一次容器重启后到问题发生期间上传的文件\"]}]]}],[\"$\",\"tr\",\"h-24\",{\"children\":[[\"$\",\"td\",\"h-25\",{\"children\":[\"后续处理\"]}],[\"$\",\"td\",\"h-26\",{\"children\":[\"通过log、数据库数据等找到了受到影响的用户，通过邮箱、电话和短信提醒他们重新上传文件\"]}]]}],[\"$\",\"tr\",\"h-27\",{\"children\":[[\"$\",\"td\",\"h-28\",{\"children\":[\"经验\"]}],[\"$\",\"td\",\"h-29\",{\"children\":[\"实现依赖业务，而非业务依赖实现；重视测试细节；log中记录尽可能多的信息\"]}]]}]]}]]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"问题发现\",\"children\":[[\"$\",\"a\",\"问题发现\",{\"href\":\"#问题发现\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"问题发现\"]]}],\"\\n\",[\"$\",\"p\",\"h-31\",{\"children\":[\"项目基本情况是这样的。用户可以注册团队，一个团队有一个队长，队长可以提交一个团队的成果文件。管理员可以看到各个队伍的提交情况，以及也可以直接下载团队提交的文件。\"]}],\"\\n\",[\"$\",\"p\",\"h-32\",{\"children\":[\"19日下午4点左右，我用管理员登录了系统，本来只是在随便看看有哪些团队提交了成果，结果突然发现有的团队的成果点击下载下不下来。\"]}],\"\\n\",[\"$\",\"p\",\"h-33\",{\"children\":[\"$L19\"]}],\"\\n\",[\"$\",\"p\",\"h-35\",{\"children\":[\"赶紧上服务器上看是怎么回事。打开服务器存放上传的文件的目录，grep一下发现对应的ID发现没有这个文件。\"]}],\"\\n\",[\"$\",\"p\",\"h-36\",{\"children\":[\"上传文件的逻辑是这样的：\"]}],\"\\n\",[\"$\",\"ol\",\"h-37\",{\"children\":[\"\\n\",[\"$\",\"li\",\"h-38\",{\"children\":[\"获取上传的文件\"]}],\"\\n\",[\"$\",\"li\",\"h-39\",{\"children\":[\"把文件保存到\",[\"$\",\"code\",\"h-40\",{\"children\":[\"upload/{团队ID}/文件名\"]}],\"\\n\",[\"$\",\"ol\",\"h-41\",{\"children\":[\"\\n\",[\"$\",\"li\",\"h-42\",{\"children\":[\"保存之前，打日志\",[\"$\",\"code\",\"h-43\",{\"children\":[\"Received file {文件名} from {用户ID}. Saving it to {完整路径}.\"]}]]}],\"\\n\",[\"$\",\"li\",\"h-44\",{\"children\":[\"保存完成后，打日志\",[\"$\",\"code\",\"h-45\",{\"children\":[\"$${完整路径} saved successfully.\"]}]]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"h-46\",{\"children\":[\"更新数据库，记录文件名(列名为\",[\"$\",\"code\",\"h-47\",{\"children\":[\"filename\"]}],\")和上传时间（\",[\"$\",\"code\",\"h-48\",{\"children\":[\"last_update_time\"]}],\"）\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"h-49\",{\"children\":[\"如果第二步失败，就不能进行第三步，不会出现保存文件失败但是写了数据库的情况。但是如果没有写数据库，我在后台就不会看到这个团队有成果，就不会能够点击下载了。\"]}],\"\\n\",[\"$\",\"p\",\"h-50\",{\"children\":[\"后端程序运行在docker中，但是\",[\"$\",\"code\",\"h-51\",{\"children\":[\"upload\"]}],\"是一个mounted volume，其中的文件和容器外的一个目录是进行了共享的，所以不管容器怎么重启，这里面的文件是不会掉的。\"]}],\"\\n\",[\"$\",\"div\",\"h-52\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-53\",{\"data-language\":\"yaml\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-54\",{\"data-language\":\"yaml\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-55\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-56\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"# docker-compose相关部分, /dist是容器中存放程序文件的根目录\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-57\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-58\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"backend\"]}],[\"$\",\"span\",\"h-59\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\":\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-60\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-61\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  \"]}],[\"$\",\"span\",\"h-62\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"volumes\"]}],[\"$\",\"span\",\"h-63\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\":\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-64\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-65\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"    - \"]}],[\"$\",\"span\",\"h-66\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"\\\"./backend/upload:/dist/upload\\\"\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-67\",{\"children\":[\"马上翻了下日志，按上面说的格式搜一下日志（下面的队伍ID为实际的团队ID）：\"]}],\"\\n\",[\"$\",\"div\",\"h-68\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-69\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-70\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-71\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-72\",{\"style\":{\"color\":\"#abb2bf\"},\"children\":[\"{container_name=\\\"backend\\\"}|=\\\"Saving it to upload/队伍ID\\\"\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-73\",{\"children\":[\"发现\",[\"$\",\"strong\",\"h-74\",{\"children\":[\"没有结果\"]}],\"。\"]}],\"\\n\",[\"$\",\"p\",\"h-75\",{\"children\":[\"这就奇怪了，于是把\",[\"$\",\"code\",\"h-76\",{\"children\":[\"upload/队伍ID\"]}],\"从查询语句中删除，直接看有哪些保存的日志，这一看就出事了。我看到了一堆这样的日志：\"]}],\"\\n\",[\"$\",\"pre\",\"h-77\",{\"children\":[[\"$\",\"code\",\"h-78\",{\"children\":[\"{\\\"level\\\":30,\\\"time\\\":1626528267191,\\\"pid\\\":36,\\\"hostname\\\":\\\"2358983e224d\\\",\\\"reqId\\\":\\\"req-29\\\",\\\"msg\\\":\\\"Received file 文件名.zip from 用户ID.\\\\n    Saving it to 团队ID/文件名.zip.\\\"}\\n\"]}]]}],\"\\n\",[\"$\",\"p\",\"h-79\",{\"children\":[\"文件被保存到\",[\"$\",\"code\",\"h-80\",{\"children\":[\"{团队ID}/文件名\"]}],\"下了！而\",[\"$\",\"code\",\"h-81\",{\"children\":[\"{团队ID}\"]}],\"这些目录是没有被mount的，容器重启就重启了，没了！\"]}],\"\\n\",[\"$\",\"p\",\"h-82\",{\"children\":[\"马上进入容器里运行\",[\"$\",\"code\",\"h-83\",{\"children\":[\"ls\"]}],\"，果然在容器根目录看到了一堆\",[\"$\",\"code\",\"h-84\",{\"children\":[\"{团队ID}\"]}],\"的目录。\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"确定影响范围和补救\",\"children\":[[\"$\",\"a\",\"确定影响范围和补救\",{\"href\":\"#确定影响范围和补救\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"确定影响范围和补救\"]]}],\"\\n\",[\"$\",\"p\",\"h-86\",{\"children\":[\"首先，我把容器里已有的这些文件复制了出来，并定时检查有没有新的文件。还好，在排查问题的整个过程中都没有新的文件名上传。这些文件应该是在上一次容器重启之后才上传的。\"]}],\"\\n\",[\"$\",\"p\",\"h-87\",{\"children\":[\"之后，是找到哪些队伍的文件仍然丢失了，也就是数据库中\",[\"$\",\"code\",\"h-88\",{\"children\":[\"filename\"]}],\"不是NULL，但是\",[\"$\",\"code\",\"h-89\",{\"children\":[\"upload\"]}],\"下面没有这个队伍。这些队伍的文件应该是在上一次重启之前就上传了，上一次重启使得这些文件丢失了，应该是无法找回了。\"]}],\"\\n\",[\"$\",\"p\",\"h-90\",{\"children\":[\"通过各种查找资料，写出来以下的bash脚本：\"]}],\"\\n\",[\"$\",\"div\",\"h-91\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-92\",{\"data-language\":\"bash\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-93\",{\"data-language\":\"bash\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-94\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-95\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"# 查询filename不是NULL的团队的ID，写入db.txt\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-96\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-97\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"query\"]}],[\"$\",\"span\",\"h-98\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"h-99\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"\\\"\\\"\\\"\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-100\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-101\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"use data_competition_prod;\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-102\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-103\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"select id from team where filename is not null;\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-104\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-105\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"\\\"\\\"\\\"\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-106\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-107\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":[\"echo\"]}],[\"$\",\"span\",\"h-108\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-109\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"$$query\"]}],[\"$\",\"span\",\"h-110\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" | \"]}],[\"$\",\"span\",\"h-111\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"mysql\"]}],[\"$\",\"span\",\"h-112\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-113\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-u\"]}],[\"$\",\"span\",\"h-114\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-115\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"root\"]}],[\"$\",\"span\",\"h-116\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-117\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-h\"]}],[\"$\",\"span\",\"h-118\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-119\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"127.0\"]}],[\"$\",\"span\",\"h-120\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\".0.1\"]}],[\"$\",\"span\",\"h-121\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-122\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-P\"]}],[\"$\",\"span\",\"h-123\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-124\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"3306\"]}],[\"$\",\"span\",\"h-125\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-126\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-p密码\"]}],[\"$\",\"span\",\"h-127\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" | \"]}],[\"$\",\"span\",\"h-128\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"sed\"]}],[\"$\",\"span\",\"h-129\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-130\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"'1d'\"]}],[\"$\",\"span\",\"h-131\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" | \"]}],[\"$\",\"span\",\"h-132\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"sort\"]}],[\"$\",\"span\",\"h-133\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-134\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-n\"]}],[\"$\",\"span\",\"h-135\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \u003e \"]}],[\"$\",\"span\",\"h-136\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"db.txt\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-137\",{\"className\":\"line\",\"children\":\"$undefined\"}],\"\\n\",[\"$\",\"span\",\"h-138\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-139\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"# 查询upload下的所有目录名，写入folder.txt\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-140\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-141\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"ls\"]}],[\"$\",\"span\",\"h-142\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-143\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-d\"]}],[\"$\",\"span\",\"h-144\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-145\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"*\"]}],[\"$\",\"span\",\"h-146\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"/\"]}],[\"$\",\"span\",\"h-147\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" | \"]}],[\"$\",\"span\",\"h-148\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"cut\"]}],[\"$\",\"span\",\"h-149\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-150\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-f1\"]}],[\"$\",\"span\",\"h-151\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-152\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-d\"]}],[\"$\",\"span\",\"h-153\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"'/'\"]}],[\"$\",\"span\",\"h-154\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" | \"]}],[\"$\",\"span\",\"h-155\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"sort\"]}],[\"$\",\"span\",\"h-156\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-157\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"-n\"]}],[\"$\",\"span\",\"h-158\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \u003e \"]}],[\"$\",\"span\",\"h-159\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"folder.txt\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-160\",{\"className\":\"line\",\"children\":\"$undefined\"}],\"\\n\",[\"$\",\"span\",\"h-161\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-162\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"# diff两个文件\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-163\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-164\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"diff\"]}],[\"$\",\"span\",\"h-165\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-166\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"db.txt\"]}],[\"$\",\"span\",\"h-167\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-168\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"folder.txt\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-169\",{\"children\":[\"这个bash脚本得出filename不是NULL的、但是upload下没有对应的目录有\",[\"$\",\"strong\",\"h-170\",{\"children\":[\"11\"]}],\"个。所以这11个团队的文件是丢失了。\"]}],\"\\n\",[\"$\",\"p\",\"h-171\",{\"children\":[\"但是除了丢失文件的情况，还有在出现问题之前就上传了版本，但是在这问题发生后更新了文件。这样，虽然在系统上有他们的问题，但是这些文件版本不是最终的版本。\"]}],\"\\n\",[\"$\",\"p\",\"h-172\",{\"children\":[\"为了找到这些团队，首先需要找到最近几次重启的时间，以及问题开始时的时间。容器重启的时候之前的容器会被强制退出，会打出有\",[\"$\",\"code\",\"h-173\",{\"children\":[\"npm ERR\"]}],\"的日志，通过这个ERR可以找到最近几次重启的时间。\"]}],\"\\n\",[\"$\",\"div\",\"h-174\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-175\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-176\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-177\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-178\",{\"style\":{\"color\":\"#abb2bf\"},\"children\":[\"{container_name=\\\"backend\\\"}|=\\\"npm ERR\\\"\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-179\",{\"children\":[\"$L1a\"]}],\"\\n\",[\"$\",\"p\",\"h-181\",{\"children\":[\"可以看到图上有三次重启：\"]}],\"\\n\",[\"$\",\"ul\",\"h-182\",{\"children\":[\"\\n\",[\"$\",\"li\",\"h-183\",{\"children\":[[\"$\",\"code\",\"h-184\",{\"children\":[\"2021-07-16 09:00:10\"]}],\" (\",[\"$\",\"code\",\"h-185\",{\"children\":[\"t1\"]}],\")\"]}],\"\\n\",[\"$\",\"li\",\"h-186\",{\"children\":[[\"$\",\"code\",\"h-187\",{\"children\":[\"2021-07-16 15:50:07\"]}]]}],\"\\n\",[\"$\",\"li\",\"h-188\",{\"children\":[[\"$\",\"code\",\"h-189\",{\"children\":[\"2021-07-17 18:00:57\"]}],\" (\",[\"$\",\"code\",\"h-190\",{\"children\":[\"t3\"]}],\")\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"h-191\",{\"children\":[\"最后一次重启（19日的）是后面修改代码中的bug引发的重启，此时文件能恢复的文件已经恢复。而查询时间段之前的代码我知道是没有问题的。所以可以确定，\",[\"$\",\"code\",\"h-192\",{\"children\":[\"t1\"]}],\"-\",[\"$\",\"code\",\"h-193\",{\"children\":[\"t3\"]}],\"之间的数据是丢失了，而我之前从容器中补救出的文件是\",[\"$\",\"code\",\"h-194\",{\"children\":[\"t3\"]}],\"之后的数据。\"]}],\"\\n\",[\"$\",\"p\",\"h-195\",{\"children\":[\"为了确定事情是不是\",[\"$\",\"code\",\"h-196\",{\"children\":[\"t1\"]}],\"这次重启后发生，我又进行了一次确认。问题的原因是没有保存到\",[\"$\",\"code\",\"h-197\",{\"children\":[\"upload/团队ID/\"]}],\"下，而是直接保存到\",[\"$\",\"code\",\"h-198\",{\"children\":[\"团队ID/\"]}],\"下，可以通过正则表达式匹配\",[\"$\",\"code\",\"h-199\",{\"children\":[\"Saving it to 数字\"]}],\"的log，查看第一次出现这样的log的时间为\",[\"$\",\"code\",\"h-200\",{\"children\":[\"2021-07-16 09:24:28\"]}],\"，是在\",[\"$\",\"code\",\"h-201\",{\"children\":[\"t1\"]}],\"之后，所以可以确定原来的时间段是正确的，或者说，更详细的说是9点24-15点50之间的数据丢失了。\"]}],\"\\n\",[\"$\",\"div\",\"h-202\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-203\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-204\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-205\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-206\",{\"style\":{\"color\":\"#abb2bf\"},\"children\":[\"{container_name=\\\"backend\\\"}|~\\\"Saving it to [0-9]+\\\"\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-207\",{\"children\":[\"$L1b\"]}],\"\\n\",[\"$\",\"p\",\"h-209\",{\"children\":[\"把查询时间设置在\",[\"$\",\"code\",\"h-210\",{\"children\":[\"t1\"]}],\"到\",[\"$\",\"code\",\"h-211\",{\"children\":[\"t3\"]}],\"之间，运行以下语句，通过正则表达式，提取在这期间上传的团队的ID，获得了一个团队ID的列表。那么这些就是受到本次影响的团队了。\"]}],\"\\n\",[\"$\",\"div\",\"h-212\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-213\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-214\",{\"data-language\":\"logql\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-215\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-216\",{\"style\":{\"color\":\"#abb2bf\"},\"children\":[\"{container_name=\\\"backend\\\"}|~\\\"Saving it to [0-9]+\\\" | regexp \\\"Saving it to (?P\u003cid\u003e[0-9]+)\\\" | line_format \\\"{{.id}}\\\"\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"后续处理\",\"children\":[[\"$\",\"a\",\"后续处理\",{\"href\":\"#后续处理\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"后续处理\"]]}],\"\\n\",[\"$\",\"p\",\"h-218\",{\"children\":[\"第一步当然是恢复还能恢复的文件并火速修改bug，并确认了一下在修改bug发布之前没有团队上传了新的文件。\"]}],\"\\n\",[\"$\",\"p\",\"h-219\",{\"children\":[\"由于这些文件无法被恢复，只能麻烦组委会其他人去通过电话、短信和邮件联系对应参赛队员，让他们重新交一份文件。\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"出错原因\",\"children\":[[\"$\",\"a\",\"出错原因\",{\"href\":\"#出错原因\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"出错原因\"]]}],\"\\n\",[\"$\",\"p\",\"h-221\",{\"children\":[\"这次项目我给后端项目写了测试，覆盖率已经达到了94.3%，对文件上传这部分也进行了重点的测试，但是为什么还是没有发现这个问题呢？\"]}],\"\\n\",[\"$\",\"p\",\"h-222\",{\"children\":[\"$L1c\"]}],\"\\n\",[\"$\",\"p\",\"h-224\",{\"children\":[\"因为之前我之前都是通过以下代码，将配置中的\",[\"$\",\"code\",\"h-225\",{\"children\":[\"config.upload.path\"]}],\"（取值为\",[\"$\",\"code\",\"h-226\",{\"children\":[\"upload\"]}],\"，就是之前根目录）和团队ID和文件名拼接起来，来获得一个团队的上传的文件的实际路径。\"]}],\"\\n\",[\"$\",\"div\",\"h-227\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-228\",{\"data-language\":\"diff\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-229\",{\"data-language\":\"diff\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-230\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-231\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"diff --git a/backend/src/entities/Team.ts b/backend/src/entities/Team.ts\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-232\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-233\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"index 38c381b..cf2957a 100644\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-234\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-235\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"--- a/backend/src/entities/Team.ts\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-236\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-237\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"+++ b/backend/src/entities/Team.ts\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-238\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-239\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"@@ -1,4 +1,3 @@\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-240\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-241\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"-import { config } from \\\"@/utils/config\\\";\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-242\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-243\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" import { EntityOrRef, toRef } from \\\"@/utils/orm\\\";\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-244\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-245\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" import {\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-246\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-247\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"   ArrayType, Collection, Entity, IdentifiedReference,\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-248\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-249\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"@@ -66,7 +65,7 @@ export class Team {\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-250\",{\"className\":\"line\",\"children\":\"$undefined\"}],\"\\n\",[\"$\",\"span\",\"h-251\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-252\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"   get filePath() {\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-253\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-254\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"     return this.filename\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-255\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-256\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"-      ? urljoin(config.upload.path, this.id + \\\"\\\", this.filename)\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-257\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-258\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"+      ? urljoin(this.id + \\\"\\\", this.filename)\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-259\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-260\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"       : undefined;\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-261\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-262\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"   }\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-263\",{\"children\":[\"这次错误的commit为了重构\",[\"$\",\"strong\",\"h-264\",{\"children\":[\"下载\"]}],\"的相关代码，修改了这个地方的计算逻辑，把拼接\",[\"$\",\"code\",\"h-265\",{\"children\":[\"config.upload.path\"]}],\"的代码移到了处理下载请求的代码中，而忘记了\",[\"$\",\"strong\",\"h-266\",{\"children\":[\"上传\"]}],\"时确定文件保存的路径时也使用了这个\",[\"$\",\"code\",\"h-267\",{\"children\":[\"filePath\"]}],\" getter，造成了上传时使用的路径不包含顶级的\",[\"$\",\"code\",\"h-268\",{\"children\":[\"config.upload.path\"]}],\"，而是直接就是\",[\"$\",\"code\",\"h-269\",{\"children\":[\"{团队ID}/文件名\"]}],\"。\"]}],\"\\n\",[\"$\",\"p\",\"h-270\",{\"children\":[\"而在测试中，判断上传之后的文件是否存在时，仍然是使了\",[\"$\",\"code\",\"h-271\",{\"children\":[\"filePath\"]}],\" getter获得路径，这使得其实不管\",[\"$\",\"code\",\"h-272\",{\"children\":[\"filePath\"]}],\"怎么写，测试肯定都能通过，因为测试代码和业务代码所使用的计算路径的代码是相同的，所以并没有发现目录计算错误这个问题。\"]}],\"\\n\",[\"$\",\"div\",\"h-273\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-274\",{\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-275\",{\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-276\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-277\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"// 测试文件是否存在\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-278\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-279\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"expect\"]}],[\"$\",\"span\",\"h-280\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"h-281\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"path\"]}],[\"$\",\"span\",\"h-282\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-283\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"basename\"]}],[\"$\",\"span\",\"h-284\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"h-285\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"t\"]}],[\"$\",\"span\",\"h-286\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-287\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"filePath\"]}],[\"$\",\"span\",\"h-288\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":[\"!\"]}],[\"$\",\"span\",\"h-289\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\")).\"]}],[\"$\",\"span\",\"h-290\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"toBe\"]}],[\"$\",\"span\",\"h-291\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"h-292\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"newFileName\"]}],[\"$\",\"span\",\"h-293\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\");\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"教训\",\"children\":[[\"$\",\"a\",\"教训\",{\"href\":\"#教训\",\"className\":\"mr-2\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"教训\"]]}],\"\\n\",[\"$\",\"ol\",\"h-295\",{\"children\":[\"\\n\",[\"$\",\"li\",\"h-296\",{\"children\":[\"实现依赖业务，而非业务依赖实现\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"h-297\",{\"children\":[\"之前把计算文件真实路径的代码放在业务模型里（\",[\"$\",\"code\",\"h-298\",{\"children\":[\"filePath\"]}],\"属性）这样的设计是有问题的。\"]}],\"\\n\",[\"$\",\"p\",\"h-299\",{\"children\":[\"按照DDD的思想，\",[\"$\",\"strong\",\"h-300\",{\"children\":[\"业务逻辑\"]}],\"（保存用户上传的文件）不应该直接依赖\",[\"$\",\"strong\",\"h-301\",{\"children\":[\"实现逻辑\"]}],\"（通过\",[\"$\",\"code\",\"h-302\",{\"children\":[\"config.upload.path\"]}],\"计算实际路径，然后使用\",[\"$\",\"code\",\"h-303\",{\"children\":[\"fs\"]}],\"直接操作文件系统），而是应该反过来，实现层面依赖业务逻辑。也就是说，应该\"]}],\"\\n\",[\"$\",\"blockquote\",\"h-304\",{\"children\":[\"\\n\",[\"$\",\"p\",\"h-305\",{\"children\":[\"提供一个保存用户文件的方法，这个方法接受保存文件所需要参数（比如操作用户、文件名、文件流），这个方法来负责进行实际保存文件的工作。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"h-306\",{\"children\":[\"用传统的OO和DI的说法，就是定义一个保存文件的接口，实现层实现实际的保存文件的逻辑，并通过DI注入给用户逻辑。业务逻辑通过这个接口完成保存文件的工作。\"]}],\"\\n\",[\"$\",\"p\",\"h-307\",{\"children\":[\"这样，既可以避免本文这种问题，还有利于以后进行扩展，比如不保存到本地，而是保存到云端的存储。\"]}],\"\\n\",[\"$\",\"ol\",\"h-308\",{\"start\":2,\"children\":[\"\\n\",[\"$\",\"li\",\"h-309\",{\"children\":[\"重视测试细节\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"h-310\",{\"children\":[\"虽然这次写的测试并没有发现这个问题，但是现在复盘发现，如果在运行测试的时候能够留意并重视一个细节的话，仍然也可以发现这个错误。\"]}],\"\\n\",[\"$\",\"p\",\"h-311\",{\"children\":[\"测试结束后的运行的代码（\",[\"$\",\"code\",\"h-312\",{\"children\":[\"afterEach\"]}],\"）中，指定了删除\",[\"$\",\"code\",\"h-313\",{\"children\":[\"config.upload.path\"]}],\"的目录。\"]}],\"\\n\",[\"$\",\"div\",\"h-314\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-315\",{\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-316\",{\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-317\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-318\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"afterEach\"]}],[\"$\",\"span\",\"h-319\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"h-320\",{\"style\":{\"color\":\"#C678DD\"},\"children\":[\"async\"]}],[\"$\",\"span\",\"h-321\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" () \"]}],[\"$\",\"span\",\"h-322\",{\"style\":{\"color\":\"#C678DD\"},\"children\":[\"=\u003e\"]}],[\"$\",\"span\",\"h-323\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" {\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-324\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-325\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  \"]}],[\"$\",\"span\",\"h-326\",{\"style\":{\"color\":\"#C678DD\"},\"children\":[\"await\"]}],[\"$\",\"span\",\"h-327\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-328\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"server\"]}],[\"$\",\"span\",\"h-329\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-330\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"close\"]}],[\"$\",\"span\",\"h-331\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"();\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-332\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-333\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  \"]}],[\"$\",\"span\",\"h-334\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"// delete the test upload path\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-335\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-336\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  \"]}],[\"$\",\"span\",\"h-337\",{\"style\":{\"color\":\"#C678DD\"},\"children\":[\"await\"]}],[\"$\",\"span\",\"h-338\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-339\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"fs\"]}],[\"$\",\"span\",\"h-340\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-341\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"promises\"]}],[\"$\",\"span\",\"h-342\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-343\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"rmdir\"]}],[\"$\",\"span\",\"h-344\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"h-345\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"config\"]}],[\"$\",\"span\",\"h-346\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-347\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":[\"upload\"]}],[\"$\",\"span\",\"h-348\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\".\"]}],[\"$\",\"span\",\"h-349\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"path\"]}],[\"$\",\"span\",\"h-350\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\", { \"]}],[\"$\",\"span\",\"h-351\",{\"style\":{\"color\":\"#E06C75\"},\"children\":[\"recursive\"]}],[\"$\",\"span\",\"h-352\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\": \"]}],[\"$\",\"span\",\"h-353\",{\"style\":{\"color\":\"#D19A66\"},\"children\":[\"true\"]}],[\"$\",\"span\",\"h-354\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" });\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-355\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-356\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  \"]}],[\"$\",\"span\",\"h-357\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-358\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-359\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"});\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-360\",{\"children\":[\"但是由于错误的代码没有写到这个目录中，删除\",[\"$\",\"code\",\"h-361\",{\"children\":[\"config.upload.path\"]}],\"并不能删除测试上传所创建的文件，那么跑完测试将会有新的文件生成，就像下面这样：\"]}],\"\\n\",[\"$\",\"div\",\"h-362\",{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[[\"$\",\"pre\",\"h-363\",{\"data-language\":\"bash\",\"data-theme\":\"default\",\"children\":[[\"$\",\"code\",\"h-364\",{\"data-language\":\"bash\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",\"h-365\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-366\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"➜\"]}],[\"$\",\"span\",\"h-367\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  \"]}],[\"$\",\"span\",\"h-368\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"git\"]}],[\"$\",\"span\",\"h-369\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-370\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"status\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-371\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-372\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"On\"]}],[\"$\",\"span\",\"h-373\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-374\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"branch\"]}],[\"$\",\"span\",\"h-375\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-376\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"master\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-377\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-378\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"Your\"]}],[\"$\",\"span\",\"h-379\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-380\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"branch\"]}],[\"$\",\"span\",\"h-381\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-382\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"is\"]}],[\"$\",\"span\",\"h-383\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-384\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"up\"]}],[\"$\",\"span\",\"h-385\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-386\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"to\"]}],[\"$\",\"span\",\"h-387\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-388\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"date\"]}],[\"$\",\"span\",\"h-389\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-390\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"with\"]}],[\"$\",\"span\",\"h-391\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-392\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"'origin/master'.\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-393\",{\"className\":\"line\",\"children\":\"$undefined\"}],\"\\n\",[\"$\",\"span\",\"h-394\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-395\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"Untracked\"]}],[\"$\",\"span\",\"h-396\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-397\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"files:\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-398\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-399\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"  (\"]}],[\"$\",\"span\",\"h-400\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"use\"]}],[\"$\",\"span\",\"h-401\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-402\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"\\\"git add \u003cfile\u003e...\\\"\"]}],[\"$\",\"span\",\"h-403\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-404\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"to\"]}],[\"$\",\"span\",\"h-405\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-406\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"include\"]}],[\"$\",\"span\",\"h-407\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-408\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"in\"]}],[\"$\",\"span\",\"h-409\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-410\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"what\"]}],[\"$\",\"span\",\"h-411\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-412\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"will\"]}],[\"$\",\"span\",\"h-413\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-414\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"be\"]}],[\"$\",\"span\",\"h-415\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\" \"]}],[\"$\",\"span\",\"h-416\",{\"style\":{\"color\":\"#98C379\"},\"children\":[\"committed\"]}],[\"$\",\"span\",\"h-417\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\")\"]}]]}],\"\\n\",[\"$\",\"span\",\"h-418\",{\"className\":\"line\",\"children\":[[\"$\",\"span\",\"h-419\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":[\"        \"]}],[\"$\",\"span\",\"h-420\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":[\"10/\"]}]]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"h-421\",{\"children\":[\"现在我想起来，当时确实发现了这个问题，但是并没有引起重视。\"]}],\"\\n\",[\"$\",\"ol\",\"h-422\",{\"start\":3,\"children\":[\"\\n\",[\"$\",\"li\",\"h-423\",{\"children\":[\"log中记录尽可能多的信息\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"h-424\",{\"children\":[\"从上面的发现问题的过程中可以发现，log相当重要。要是log中没有记录真实的完整路径，我可能需要花更多时间才能明白问题的原因。要是没有对每次文件保存都打log，我甚至都不能知道哪些队伍受到了影响。log记录了系统运行的整个流程，是分析系统的运行流程的最准确的工具。如果log打得好的话，能够从log中提取出很多没有记录到数据库中的数据。\"]}],\"\\n\",[\"$\",\"p\",\"h-425\",{\"children\":[\"所以应该在log里尽可能记录更多的信息。最基本的，错误必须打到log中，不能直接吞掉。而且在进行一些容易出错的行为时，也应该尽可能把相关上下文打到log里，以供后续查找。\"]}]]}],[\"$\",\"div\",null,{\"className\":\"hidden lg:block lg:w-[25%]\",\"children\":[\"$\",\"$L1d\",null,{\"toc\":[{\"depth\":1,\"value\":\"生产事故\",\"id\":\"生产事故\"},{\"depth\":1,\"value\":\"TL;DR\",\"id\":\"tldr\"},{\"depth\":1,\"value\":\"问题发现\",\"id\":\"问题发现\"},{\"depth\":1,\"value\":\"确定影响范围和补救\",\"id\":\"确定影响范围和补救\"},{\"depth\":1,\"value\":\"后续处理\",\"id\":\"后续处理\"},{\"depth\":1,\"value\":\"出错原因\",\"id\":\"出错原因\"},{\"depth\":1,\"value\":\"教训\",\"id\":\"教训\"}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"1e:I{\"id\":\"2834\",\"chunks\":[\"309:static/chunks/70bb1395-19ca908277f9fed9.js\",\"975:static/chunks/dc6764d5-18938ac2fbe13f06.js\",\"344:static/chunks/2e69a9b8-691073cd158eaece.js\",\"813:static/chunks/813-ce8533623af1c58b.js\",\"647:static/chunks/647-9f8470e794e19f41.js\",\"922:static/chunks/922-a0188e3000b8a10c.js\",\"94:static/chunks/app/about/[id]/[[...lang]]/page-17e8589ff0aa5197.js\"],\"name\":\"ArticleImage\",\"async\":false}\n19:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L1e\",null,{\"filePath\":\"contents/20210721-summary-of-a-f"])</script><script>self.__next_f.push([1,"ile-lost-accident/download-error.png\",\"imageSize\":{\"height\":135,\"width\":435},\"imageProps\":{\"src\":\"download-error.png\",\"alt\":\"点击下载提交的团队的成果发现出错\",\"children\":\"$undefined\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"点击下载提交的团队的成果发现出错\"}]]}]\n1a:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L1e\",null,{\"filePath\":\"contents/20210721-summary-of-a-file-lost-accident/reboot-logs.png\",\"imageSize\":{\"height\":588,\"width\":1579},\"imageProps\":{\"src\":\""])</script><script>self.__next_f.push([1,"reboot-logs.png\",\"alt\":\"最近几次重启的时间\",\"children\":\"$undefined\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"最近几次重启的时间\"}]]}]\n1b:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L1e\",null,{\"filePath\":\"contents/20210721-summary-of-a-file-lost-accident/first-bad-log.png\",\"imageSize\":{\"height\":797,\"width\":1581},\"imageProps\":{\"src\":\"first-bad-log.png\",\"alt\":\"第一次保存错目录的log\",\"children\":\"$undefined\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"child"])</script><script>self.__next_f.push([1,"ren\":\"第一次保存错目录的log\"}]]}]\n1c:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L1e\",null,{\"filePath\":\"contents/20210721-summary-of-a-file-lost-accident/test-coverage.png\",\"imageSize\":{\"height\":84,\"width\":679},\"imageProps\":{\"src\":\"test-coverage.png\",\"alt\":\"后端测试覆盖\",\"children\":\"$undefined\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"后端测试覆盖\"}]]}]\n"])</script></body></html>