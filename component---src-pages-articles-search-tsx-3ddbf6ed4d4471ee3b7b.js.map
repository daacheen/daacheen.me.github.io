{"version":3,"sources":["webpack://ddadaal.me/./src/pages/articles/search.tsx"],"names":["root","lang","locationStore","useStore","LocationStore","metadataStore","MetadataStore","query","page","pageIndex","searchResult","Array","from","articleIdMap","values","filter","articles","some","article","frontmatter","title","toUpperCase","includes","tags","tag","getAllVariationsOfTag","existingTag","sort","a","b","Date","date","getTime","totalCount","length","pageCount","Math","ceil","slice","titleId","id","replacements","key","info","ids","map","x","toPage","pageNum","path","encodeURIComponent","navigate"],"mappings":"4NAWMA,EAAOC,YA4Fb,UAnF6B,WAE3B,IAAMC,GAAgBC,QAASC,KACzBC,GAAgBF,QAASG,KAE/B,EAA4BJ,EAAcK,MAAlCA,EAAR,EAAQA,MAAR,IAAeC,YAAf,MAAsB,EAAtB,EAEMC,EAAYD,EAAO,EAErBE,EAAeC,MAAMC,KAAKP,EAAcQ,aAAaC,UAErDP,IACFG,EAAeA,EAAaK,QAAO,SAACC,GAElC,QAAIA,EAASC,MAAK,SAACC,GAAD,OAChBA,EAAQC,YAAYC,MAAMC,cAAcC,SAASf,EAAMc,qBAKrDL,EAASC,MAAK,SAACC,GAAD,OACa,OAA7BA,EAAQC,YAAYI,MACjBL,EAAQC,YAAYI,KAAKN,MAAM,SAACO,GAAD,OAChCnB,EAAcoB,sBAAsBD,GAAKP,MAAK,SAACS,GAAD,OAC5CA,EAAYL,cAAcC,SAASf,EAAMc,4BAYnDX,EAAaiB,MAAK,SAACC,EAAGC,GAAJ,OAChB,IAAIC,KAAKD,EAAE,GAAGV,YAAYY,MAAMC,UAC/B,IAAIF,KAAKF,EAAE,GAAGT,YAAYY,MAAMC,aAEnC,IAAMC,EAAavB,EAAawB,OAE1BC,EAAYC,KAAKC,KAAKJ,EA5Cb,GAoDf,OALAvB,EAAeA,EAAa4B,MA/Cb,EAgDb7B,EAhDa,EAiDbA,EAjDa,GAqDb,gBAAC,IAAD,KACE,gBAAC,IAAD,CACE8B,QAASvC,EAAKoB,QAEhB,0BACE,gBAAC,KAAD,CAAiBoB,GAAIxC,EAAKoB,MAAOqB,aAAc,CAC7C,0BAAQC,IAAK,SAAUnC,OAI3B,6BACE,gBAAC,KAAD,CAAiBiC,GAAIxC,EAAK2C,KAAMF,aAAc,CAC5CR,MAIJ,2BACA,gBAAC,IAAD,CACEW,IAAKlC,EAAamC,KAAI,SAACC,GAAD,OAAOA,EAAE,GAAG3B,YAAYqB,MAC9CL,UAAWA,EACX1B,UAAWD,EAAO,EAClBuC,OAAQ,SAACC,GACP,IAEMC,EAAI,qBADO,SADIC,mBAAmB3C,GAAS,IAChC,UAAiCyC,EAAU,IAE5D,OAAO,kBAAMG,cAASF","file":"component---src-pages-articles-search-tsx-3ddbf6ed4d4471ee3b7b.js","sourcesContent":["import React from \"react\";\nimport { LocalizedString } from \"simstate-i18n\";\nimport { lang } from \"@/i18n\";\nimport LocationStore from \"@/stores/LocationStore\";\nimport MetadataStore from \"@/stores/MetadataStore\";\nimport { navigate } from \"gatsby\";\nimport ArticleItemList from \"@/components/Article/ArticleItemList\";\nimport ArticleListLayout from \"@/layouts/ArticleListLayout\";\nimport { useStore } from \"simstate\";\nimport { PageMetadata } from \"@/components/PageMetadata\";\n\nconst root = lang.search;\n\ninterface Query {\n  query?: string;\n  page?: number;\n}\n\nconst pageSize = 5;\n\nconst SearchPage: React.FC = () => {\n\n  const locationStore = useStore(LocationStore);\n  const metadataStore = useStore(MetadataStore);\n\n  const { query, page = 1 } = locationStore.query as Query;\n\n  const pageIndex = page - 1;\n\n  let searchResult = Array.from(metadataStore.articleIdMap.values());\n\n  if (query) {\n    searchResult = searchResult.filter((articles) => {\n      // filter according to title\n      if (articles.some((article) =>\n        article.frontmatter.title.toUpperCase().includes(query.toUpperCase()))) {\n        return true;\n      }\n\n      // filter according to tag\n      if (articles.some((article) =>\n        article.frontmatter.tags !== null // article has tags\n        && article.frontmatter.tags.some(((tag) => // one of the tag satisfies:\n          metadataStore.getAllVariationsOfTag(tag).some((existingTag) =>\n            existingTag.toUpperCase().includes(query.toUpperCase()),\n          )\n        )),\n      )) {\n        return true;\n      }\n\n      // add more filters here\n      return false;\n    });\n  }\n\n  searchResult.sort((a, b) =>\n    new Date(b[0].frontmatter.date).getTime() -\n     new Date(a[0].frontmatter.date).getTime());\n\n  const totalCount = searchResult.length;\n\n  const pageCount = Math.ceil(totalCount / pageSize);\n\n  // pagination\n  searchResult = searchResult.slice(\n    pageIndex * pageSize,\n    pageIndex * pageSize + pageSize\n  );\n\n  return (\n    <ArticleListLayout>\n      <PageMetadata\n        titleId={root.title}\n      />\n      <h3>\n        <LocalizedString id={root.title} replacements={[\n          <strong key={\"query\"}>{query}</strong>,\n        ]}\n        />\n      </h3>\n      <small>\n        <LocalizedString id={root.info} replacements={[\n          totalCount,\n        ]}\n        />\n      </small>\n      <hr />\n      <ArticleItemList\n        ids={searchResult.map((x) => x[0].frontmatter.id)}\n        pageCount={pageCount}\n        pageIndex={page - 1}\n        toPage={(pageNum) => {\n          const queryEncoded = encodeURIComponent(query || \"\");\n          const querystring = `query=${queryEncoded}&page=${pageNum + 1}`;\n          const path = `/articles/search?${querystring}`;\n          return () => navigate(path);\n        }}\n      />\n    </ArticleListLayout>\n  );\n};\n\nexport default SearchPage;\n"],"sourceRoot":""}